---
title: "Джастин Берман - Лёгкие кошельки Monero: сегодня и завтра"
date: "2023-06-24"
categories:
  - "Стенограмма"
tags:
  - "MoneroKon 2023"
lead: "Monero Konferenco 2023 #MoneroKon2023 Прага - День 2"
pager: true
toc: false
sidebar: "right"
---

{{< youtube id="CjeoCeCZLsg" autoplay="false" >}}

---

_**Джастин:**_ Привет! На GitHub и Matrix я известен как J-Berman. И сегодня я буду говорить о лёгких кошельках Monero, об их состоянии на данный момент, и о том, что с ними произойдёт после предполагаемого будущего обновления, которое в настоящее время находится в разработке, это Seraphis/Jamtis. Последние дни оно здесь упоминалось довольно часто. И я начну с короткого вступления, и проведу некоторые аналогии.

Если у вас имеется полнофункциональный кошелёк Monero, использующий свой собственный узел, работающий из дома или откуда-то ещё, если вы создали собственный сервер лёгкого кошелька со своей собственной инфраструктурой, и ваш кошелёк указывает на ваш собственный узел, если такой уровень приватности для вас сродни крепостным стенам, то я бы скорее сравнил это — и я ещё вернусь к этому, говоря о предлагаемом обновлении — я бы сравнил это с забором из проволочной сетки с колючей проволокой, натянутой поверх него. Это не идеальное решение. А существующие лёгкие кошельки я бы сравнил с практически никак не защищёнными воротами, в которые может войти любой желающий.

Итак, о существующих лёгких кошельках. По сути, сегодня в Monero, чтобы идентифицировать свои транзакции, и я уверен, что каждый, кто пользовался Monero, сталкивался с этим, приходится сканировать каждую транзакцию, появившуюся в блокчейне с момента последнего открытия кошелька. Допустим, вы не пользовались Monero неделю или несколько недель, и ваш кошелёк при загрузке будет сканировать каждую транзакцию. И если вы действительно давно не пользовались своим кошельком, то это может занять довольно много времени.

Идея лёгких кошельков состоит в том, чтобы переложить бремя сканирования на отдельный сервер, называемый сервером лёгких кошельков. Он выполняет сканирование за вас, а затем, как только вы откроете свой кошелёк на телефоне или где-нибудь ещё, он мгновенно загрузится и сразу же будет готов к работе без какой-либо необходимости в таком сканировании.

Существует несколько вариантов реализации сервера лёгких кошельков с открытым исходным кодом. Один из них, созданный vtnerd, называется Monero-lws, другой, созданный moneroexamples, называется OpenMonero. В целом они работают следующим образом: они идентифицируют все выходы Monero, полученные вами в прошлом, и видят каждую сумму, а также с высокой точностью определяют ваши траты всякий раз, когда вы тратили Monero.

Предлагаемое обновление — это сервер лёгких кошельков, выполняющий сканирование, но не получающий никакой информации о суммах ваших транзакций Monero, и не способный точно определить, какие выходы были получены и потрачены вами. Но с некоторыми оговорками, о которых я расскажу чуть позже.

Итак, я планирую рассказать о том, как работают существующие на сегодня лёгкие кошельки, какой уровень приватности пользователей они обеспечивают, и каков при этом их опыт взаимодействия, а затем сделать то же самое в отношении предлагаемых, будущих лёгких кошельков.

И для начала чуть подробнее остановимся на существующих лёгких кошельках. В случае с Monero существует закрытый ключ просмотра, который в сочетании с основным адресом позволяет увидеть все входящие транзакции. Поэтому пользователи отправляют их серверу лёгких кошельков, и сервер идентифицирует все входящие транзакции, все получаемые пользователем выходы Monero, а также все транзакции, в которых пользователь мог потратить выходы, полученные в прошлом. Таким образом, когда пользователь открывает клиент своего лёгкого кошелька, он загружает всю эту информацию, мгновенно криптографически определяет, какие из трат действительно принадлежат ему, и кошелёк сразу же готов к работе.

Таким образом, сервер лёгких кошельков технически не может криптографически определить, в каких транзакциях пользователь потратил Monero, но он может с очень высокой степенью точности сделать вывод об этом. И ещё один уровень приватности, который в настоящее время технически обеспечивают лёгкие кошельки, гарантирует, что сервер не сможет увидеть адрес получателя, на который пользователь отправит Monero. Так что, как я уже сказал, это скорее ворота, но не открытый забор.

И здесь показан пример транзакции А. Эти слайды я взял из своего выступления на Monerotopia, которое состоялось в прошлом месяце. По сути, идея примера, который я собираюсь привести, сводится к демонстрации того, как серверы лёгких кошельков, обладая только ключом просмотра входящих транзакций, на данный момент способны с высокой точностью определить, какие транзакции являются транзакциями траты пользователя.

Итак, вот пример транзакции A, которая была проведена в августе 2022 года. Пользователь получил 10 Monero в выходе, называемым нами enote. Согласно терминологии, принятой в Seraphis, выход обозначается словом enote, так что это практически взаимозаменяемые понятия. Таким образом, в качестве выхода данной транзакции пользователь получает один enote достоинством 10 Monero. И это всё, что позволяет увидеть ключ просмотра входящих транзакций в этом случае.

А здесь мы видим все транзакции, также содержащие этот enote в качестве своего потенциального входа, который в будущем будет сохранён в блокчейне. Текущий вариант реализации кольцевых подписей Monero предполагает наличие в кольце 16 участников. Так что, по сути, каждая из этих транзакций содержит кольцо, состоящее из 16 участников, и в одной из них присутствует enote2, который пользователь получил в качестве входа. Здесь показано 9, но всего их 14.

Итак, вот эта, выделенная жёлтым, выделяется, поскольку содержит полученный enote1 номиналом 9,2 XMR. О других транзакциях в блокчейне нет никакой информации. Единственная, которая выделяется, — вот эта выделенная жёлтым. Это и есть наш подозреваемый.

Если взглянуть на эту транзакцию пристальней, мы увидим, что в ней пользователь получил 9,2 Monero, а также сможем учесть ещё несколько цифр. Итак, исходная транзакция пользователя, транзакция A — при том, что в блокчейне Monero насчитывается 4,6 миллиона транзакций, мы смогли исключить из этого набора в 4,6 миллиона потенциальных транзакций, в которых пользователь мог потратить конкретный enote, только эту группу из 14 и, возможно, все последующие. Однако в этих 14 транзакциях, выбранных из 4,6 миллиона, пользователь получил Monero только в одной. И поэтому мы можем сделать довольно обоснованное предположение, что эти 9,2 Monero, полученные пользователем в этой транзакции, включающей первоначальный enote в качестве потенциальной траты, что эти 9,2 Monero, скорее всего, являются сдачей пользователя. И поэтому они, вероятно, 0,8 Monero ушли кому-то ещё, и именно это и есть тот неизвестный enote2 в этой транзакции. А эти 9,2 Monero — это полученные пользователем средства, и поэтому пользователь, скорее всего, с высокой вероятность, даже, пожалуй, с вероятностью в на 99 %, пользователь потратил 0,8 Monero в этой транзакции. И благодаря этому мы можем прийти к выводу, и это свойство распространяется на каждый отдельный enote, как лёгкие кошельки могут вычислить, что было потрачено пользователем.

А здесь я произвёл моделирование. Бирюзовым выделены практически все транзакции, и я произвёл симуляцию, начиная с момента включения транзакции A в блокчейн. То есть при моделировании были учтены все транзакции, добавленные в блокчейн с того момента, после чего я запустил алгоритм выбора ложного выхода для каждой из них и пометил те, которые выбрали бы enote2 из транзакции A в качестве участника кольца. Бирюзовая линия достигает пикового значения примерно на уровне 12. А вот эта красная линия — это то, что мы видели на самом деле, а именно 14 транзакций в блокчейне. Так что, по сути, на основе этого можно сделать вывод, что в случае с большинством полученных enote, которые видит пользователь, которые также видит сервер легких кошельков, можно ожидать, что сервер выделит около 12 транзакций, которые затем отправит клиенту легкого кошелька, чтобы клиент вычислил, в какой из этих 12 транзакций пользователь потратил средства. И в основном именно так и работают существующие лёгкие кошельки.

Итак, в данном случае слева показаны получаемые данные и, по сути, минимальные данные, необходимые лёгкому кошельку для отображения этих получаемых данных и этой информации в кошельке пользователя. Их объём составляет 200 байт. 200 байт на каждый полученный пользователем enote. А в случае траты, когда пользователь, возможно, потратит enote в другой транзакции, лёгкому кошельку нужно будет отправить 112 байт. Таким образом, для совершения траты требуется меньше данных, поскольку не приходится определять, что именно было получено, не приходится задействовать криптографию, чтобы определить сумму транзакции или то, была ли эта транзакция действительно получена. Таким образом, это немного меньший объём данных, но всё же сервер лёгких кошельков должен отправить эти 112 байт. Таким образом, на каждый enote, получаемый пользователем, ему придётся загрузить около 1,7 килобайта. И этот объём, скажем так,  масштабируется линейно. Если у пользователя имеется 100 полученных enote, ему придётся загрузить около 170 килобайт данных, что с функциональной точки зрения происходит мгновенно. И именно поэтому на сегодняшний день с точки зрения пользователя лёгкого кошелька всё происходит мгновенно.

А теперь перейдём к предлагаемым вариантам реализации лёгких кошельков. Вернувшись немного назад, напомню, что идея заключается в том, что сервер лёгких кошельков не видит суммы и не может точно определить, в каких транзакциях пользователь получил или потратил свои enote. Но с некоторыми оговорками, о которых мы ещё поговорим.

Итак, как будут функционировать лёгкие кошельки. Вместо того чтобы передавать серверу закрытый ключ просмотра, пользователь передаёт новый ключ, называемый «ключом обнаружения полученных данных». И этот сервер лёгких кошельков с помощью этого ключа просканирует блокчейн и для каждой транзакции определит те enote, которые пользователь мог получить, а затем потратить. При некоторых обстоятельствах сервер лёгких кошельков со 100% уверенностью может сделать это, но в большинстве случаев сервер этого не делает. Также он не может расшифровать ни одну из сумм в каком-либо из этих enote. Таким образом, по сути, он просто исключает из множества enote небольшое количество тех, которые пользователь мог получить или потратить.

По сути, не знаю, многие ли из вас знакомы с концепцией тегов просмотра, которая в настоящее время реализована в Monero, но, по сути, эта концепция и применяется в лёгких кошельках. Происходит это так: ключ обнаружения полученных данных выбирает один из 256 enote в блокчейне, который может принадлежать или не принадлежать пользователю, и отбрасывает 255 enote, которые, насколько известно серверу лёгких кошельков, не принадлежат пользователю. Таким образом, в основном все полученные enote окончательно выбираются с помощью ключа обнаружения полученных данных, включая сдачу, о которой мы ещё поговорим. В результате клиенту лёгкого кошелька для сканирования блокчейна требуется загрузить всего 0,4% данных, которые загружаются для этого сегодня полнофункциональным кошельком. На данный момент полнофункциональными являются GUI и CLI кошельки, Cake Wallet или Monerujo. И вот теперь такому лёгкому кошельку потребуется всего 0,4% данных, чтобы восстановить баланс пользователя.

И ещё одна маленькая техническая деталь, которая будет немного отличать новые лёгкие кошельки от уже существующих. Это трата с нулевой сдачей, когда пользователь хочет взять весь баланс кошелька и перевести средства в другое место. По сути, при проведении этой транзакции сдача будет нулевой, а это значит, что ключ просмотра тут не поможет, равно как и ключ обнаружения полученных данных, который технически в данном случае также будет бесполезен.

Поэтому мы предложили, чтобы все кошельки включали фиктивный enote с нулевой суммой, который ключ обнаружения полученных данных смог бы идентифицировать даже в том случае, если это будет enote с нулевой сдачей. Таким образом, если вы возьмёте мнемоническую фразу лёгкого кошелька и мнемоническую фразу GUI-кошелька, чтобы восстановить одного или другого кошелька, или если вы возьмёте мнемоническую фразу GUI, чтобы восстановить баланс в лёгком кошельке, этот лёгкий кошелёк всё равно сможет идентифицировать все транзакции пользователя и восстановить баланс.

И в данном случае имеет место пара недостатков, которые стоит подчеркнуть: каждый кошелёк должен будет технически сделать что-то, что в противном случае ему не нужно было бы делать, пользуясь преимуществом лёгкого кошелька. То есть, чтобы лёгкий кошелёк смог выбрать enote траты в каждом типе транзакций, GUI-кошельку придётся сделать что-то, что будет преимуществом для лёгкого кошелька, но не обязательно будет преимуществом для самого GUI-кошелька. Также стоит отметить, что всем существующим сегодня кошелькам приходится делать нечто подобное, то есть включать фиктивную сумму в каждую транзакцию. И если вы загляните в основную область блокчейна, то увидите, что каждая транзакция имеет как минимум два выхода. Это нужно для того, чтобы гарантировать взаимозаменяемость всех транзакций, чтобы никто не смог отличить транзакцию с нулевой сдачей от любой другой транзакции. И для достижения этой цели каждый кошелёк включает второй enote, даже в тех случаях, когда технически этого не требуется. И поэтому, в духе этой концепции, вместо того чтобы включать некий фиктивный enote, кошелёк включает тот, который действительно будет выбран ключом обнаружения полученных данных.

И другой минус состоит в том, что сервер лёгких кошельков сможет выявить больше транзакций, чем в смог бы в ином случае. И это ещё одна особенность существующих сегодня серверов лёгких кошельков. Технически они не получают дополнительной информации о входящей транзакции, но если применить эту концепцию, то технически такой сервер сможет обнаружить эти транзакции, когда в противном случае он бы этого не сделал.

Но плюс состоит в том, что лёгкому кошельку не нужно загружать каждый образ ключа с сервера, что является больным местом лёгких кошельков, которым приходится загружать большой объём данных, а затем ожидать сканирования. Теперь сканирование будет происходить практически мгновенно, а также лёгкому кошельку не нужно будет раскрывать образы своих ключей серверу, чтобы получить информацию о своих тратах. Есть и другие технические способы решения этой проблемы, но каждый из них имеет свой ряд недостатков, и этот подход представляется, я бы сказал, наименее плохим вариантом.

Итак, предлагаемый вариант лёгкого кошелька, обеспечивающего приватность пользователя. Вернёмся к недостаткам, о которых я говорил ранее. Существуют обстоятельства, при которых возможен один из двух сценариев. В первом случае сервер лёгких кошельков может криптографически идентифицировать транзакции, полученные пользователем, со 100% точностью. Действительно, есть некоторые обстоятельства, когда он может это сделать. А во втором случае он точно может определить транзакции или выявить, какие enote получил и потратил пользователь, просто анализируя происходящее на сервере. Но есть и другие недостатки, о которых мы ещё поговорим далее.

Я считаю, что из-за этих довольно серьёзных недостатков, связанных с лёгкими кошельками, пользователям по прежнему по умолчанию следует использовать собственный узел и создать его, если он ещё не создан. Такой узел должен быть создан каждым пользователем. В противном случае не стоит пользоваться лёгким кошельком, поскольку недостатки довольно серьёзны. Если у вы не поддерживаете собственный сервер лёгких кошельков, то, на мой взгляд, вы не должны использовать настройки, заданные по умолчанию.

Обстоятельства, при которых сервер со 100% точностью может определить входящие enote пользователя, возникают, если пользователь получает более двух enote на один и тот же адрес. В том числе от подобной ситуации Monero пытается защитить пользователей на уровне протокола с помощью скрытых адресов, благодаря которым вы не сможете заглянуть в блокчейн и с помощью адреса выявить транзакции, принадлежащие пользователю, как это можно сделать в случае с Bitcoin или Ethereum или любым другим блокчейном, не ориентированным на обеспечение приватности. Так что, к сожалению, в этом случае приходится отказаться от этой концепции, если сервер лёгких кошельков имеет доступ к ключу обнаружения полученных данных, и когда пользователь получает два enote, сервер способен обнаружить их уже с помощью только этого ключа. В блокчейне нет ничего, что можно было бы увидеть, но такого ключа достаточно, чтобы сказать: «Ага, это точно те enote, что были получены».

И ещё одно обстоятельство — если серверу лёгких кошельков известен адрес пользователя, это также разрушает всю концепцию. Даже если пользователь получил один enote на тот же адрес, сервер увидит это, если ему известен адрес пользователя. Это означает, что любой, кто совершает с вами транзакции, также несёт определённую ответственность за вашу приватность и не должен делиться этим адресом со всем миром. Или же, если вы опубликуете свой адрес, например, в Twitter или где-то ещё, то есть, вы сделаете это публично, сервер лёгких кошельков также сможет засечь, что вы получаете деньги, используя этот адрес.

Смягчить этот недостаток можно в том случае, если кошельки, и особенно лёгкие кошельки, станут случайным образом генерировать уникальные адреса для пользователей, которые затем будут использоваться при каждом получении. Но это не идеальное решение. Если пользователь где-нибудь опубликует свой адрес, то это не поможет. Однако кошелёк может по умолчанию генерировать уникальные адреса для каждого получения. И Jamtis, являющийся частью предлагаемого обновления протокола Monero, предполагает наличие поддержки генерации случайных адресов, в то время в случае с существующими кошельками эту функцию реализовать сложнее. Jamtis упростит процесс случайной генерации адресов, что позволит нейтрализовать этот недостаток или, по крайней мере, в некоторой степени смягчить последствия.

Также существуют обстоятельства, при которых сервер может угадать транзакции. На предыдущем слайде речь шла об обстоятельствах, при которых сервер может сделать это со 100% точностью. Но есть и такие обстоятельства, при которых сервер может просто угадать, сделав точные выводы. Прежде всего, сервер просто может зарегистрировать вход пользователя в кошелёк с последующим запросом полученных им ранее enote для построения транзакции. После этого пользователь получит с сервера или откуда-т ещё ложные выходы,  оттуда же получит информацию о комиссии, и сразу после этого транзакция уйдёт в блокчейн. И это будет совпадением, одним из 256, и сервер увидит его. Скорее всего, сервер сможет определить транзакции пользователя по этому совпадению. То есть, если пользователь будет просто отправлять свои транзакции на сервер, то сервер будет это улавливать. Так что есть обстоятельства, которых трудно избежать. В этом случае сервер будет собирать информацию, на основе которой он может просто сделать вывод, согласно которому пользователь совершает именно эти транзакции.

Также, например, бывают случаи, когда в одной транзакции пользователь получает сразу несколько выходов сдачи, как в случае с недавно реализованной Monero функцией получения «карманных денег». Сейчас, когда вы получаете немного Monero, вы не можете потратить их в течение 10 блоков, и это обеспечивает защиту пользователей от внесения изменений. И это недостаток пользовательского взаимодействия, присущий Monero, который просто существует в том виде, в котором он существует. Но теперь пользователь может обойти его с помощью функции под названием Pocket Change, «карманных денег», которая распределяет enote в каждой транзакции. Допустим, у пользователя есть несколько enote, которые он может потратить. И если, например, пользователь получил Monero в одной транзакции, а затем собирается потратить эти Monero, вместо того чтобы заблокировать его транзакцию на 10 блоков, то есть, на 20 минут, распределение выходов сдачи позволяет потратить средства без использования других enote, имеющихся в кошельке, и не ждать в течение 10 блоков.

Но с этим связан отдельный ряд проблем, связанных с приватностью, которые мы не станем сейчас рассматривать в контексте лёгких кошельков. Если пользователь получает несколько enote в одной транзакции, это, конечно же, можно будет определить с помощью ключа обнаружения полученных данных. Каждый такой enote будет выявлен с помощью такого ключа. Таким образом, это будет одна транзакция, содержащая несколько полученных enote, но вероятность этого довольно мала — одна транзакция из 256. Поэтому чем больше enote на выходе транзакции будет получено, тем больше статистических данных получит сервер, который в результате может определить, что именно в этой транзакции пользователь получил конкретные enote. Технически этот недостаток можно устранить, внеся изменения в спецификацию Jamtis. Но и это связано с рядом сложностей, о которых мы сейчас говорить не будем.

Также может возникнуть ситуация, в которой пользователь решит провести транзакцию с несколькими входами. Это ещё одно обстоятельство, при котором он оставит дополнительный статистический след. Последствия подобной ситуации могут быть смягчены с помощью доказательства участия на базе полного блокчейна. Но поскольку пока мы используем кольцевые подписи, и поскольку они изначально были предложены как часть протокола Seraphis, это ещё одно обстоятельство, при котором вы оставляете статистический след, воспользовавшись которым сервер лёгких кошельков сможет произвести дополнительный анализ. Поэтому, в конечном счёте, я рекомендую использовать собственный сервер лёгких кошельков, чтобы не передавать такую информацию третьей стороне.

Итак, нами были рассмотрены возможные варианты реализации будущих лёгких кошельков и то, как будет происходить загрузка данных. Здесь слева представлена вся информация, необходимая на уровне транзакций. Информация, которую пользователю придётся загружать при построении каждой транзакции, чтобы ключ обнаружения полученных данных смог выбрать соответствующий enote. Это хэш, образы ключей для каждой транзакции и прочая информация. А справа показана информация, связанная с каждым enote. Таким образом, для каждого enote, идентифицируемого с помощью ключа обнаружения полученных данных в каждой транзакции, придётся загрузить такое количество байт.

За последний год в блокчейн было добавлено около 14 миллионов новых выходов. И сервер лёгких кошельков идентифицирует один из 256 таких выходов, что в итоге составляет около 54 500 выходов. Таким образом, если смоделировать это с помощью данных блокчейна за последний год и посмотреть, что должен будет скачать лёгкий кошелёк при использовании предложенной схеме, то получится около 15,7 мегабайта. И это постоянная величина. Так что даже при наличии у пользователя тысяч полученных enote, это не изменит объёма загружаемых данных. Он останется постоянным на уровне 15,7-16 мегабайт. Именно столько нужно будет загрузить, если кошелёк не использовался в течение года. И технически это нужно будет сделать только один раз, а дальше — несколько сотен килобайт в день, что бы ни случилось. И это довольно быстро, учитывая что вы не использовали кошелёк в течение года, а также тысячи Интернет-соединений и скорость загрузки. Но всё также зависит от доступной пропускной способности.

Итак, основной вывод из всего сказанного заключается в том, что в рамках нового предложения лёгкие кошельки обеспечат более высокий уровень приватности, чем обеспечивают сегодня, а также неплохой опыт пользовательского взаимодействия в плане загрузки. Но при этом существуют и те недостатки, о которых я говорил. Такова основная идея.

И я хочу сказать, что особенно рад получаемым возможностям, поскольку хотел бы запустить сервер лёгких кошельков у себя дома для своей семьи, друзей и людей и своего круга общения. Благодаря этому они получат возможность мгновенной загрузки. И я не стану регистрировать, как будет использоваться мой сервер. Но даже если бы я захотел сделать это, то не смог бы увидеть никаких сумм. И это, на мой взгляд, огромный шаг вперёд если сравнивать с существующими серверами лёгких кошельков, поскольку, если бы я решил запустить такой сервер у себя дома сегодня, то смог бы получить всю эту информацию, просто заглянув в базу данных, и увидеть полученные выходы, довольно легко вычислить баланс и так далее. А теперь я смогу запустить сервер лёгких кошельков у себя, получая при этом очень мало информации о семье и друзьях или вообще не получая её. И думаю, такая модель является довольно масштабируемой и позволяет привлечь большее количество людей к использованию Monero. Вопросы?
