---
title: "Саша - P2P обмен данными по сети: децентрализованный подход с устойчивым ограничением скорости"
date: "2024-06-07"
categories:
  - "Стенограмма"
tags:
  - "MoneroKon 2024"
lead: "Monero Konferenco 2024 #MoneroKon2024 Прага"
pager: true
toc: false
sidebar: "right"
---

{{< youtube id="OhK6DcB7pCc" autoplay="false" >}}

---

_**Аннотация выступления**_

В данной презентации рассматриваются инновационные стратегии развития одноранговых сетей не требующих разрешения, которые отдают приоритет конфиденциальности. В презентации также рассматриваются механизмы сохранения анонимности пользователей при внедрении эффективных решений по ограничению скорости для обеспечения эффективности и безопасности сети.

_**Стенограмма выступления:**_

_**Саша:**_ Здравствуйте, меня зовут Саша. Я представляю проект Waku, и сегодня я поделюсь с вами некоторыми идеями, которые мы разработали в рамках работы над протоколом Waku, связанными с ограничением скорости одноранговых сетей.

Предлагаю начать с небольшого обзора. Затем я расскажу о текущем состоянии одноранговых сетей, о тех их свойствах, на которых мы акцентируем своё внимание. Затем мы рассмотрим два типа существующих сетей, параллельные типы сетей, противоположные друг другу. Затем мы рассмотрим допуски, связанные с доверием, которые часто используют эти типы сетей. Затем коснёмся общих буквально повседневных проблем, характерных для одноранговых сетей. После этого рассмотрим возможности ограничения скорости в сетях первого и второго типа, а также то, как это предлагается делать с помощью протокола Waku. А затем я расскажу о сети Waku, о некоторых реализованных нами протоколах, об истории создания нашей сети и о том, почему мы вообще занимаемся этим.

Итак, небольшой обзор. Если говорить о свойствах одноранговых сетей, некоторые из них сводятся к отсутствию какого-либо центрального органа, управляющего подобной огромной сетью. Это то, к чему мы стремимся в идеале. Всё совсем не обязательно обстоит именно так, потому что это зависит от архитектуры, и это может быть, скажем так, вопросом аппаратного обеспечения или логического, не аппаратного, или не только аппаратного, но не логического. Прошу прощения.

Затем мы также учитываем возможность прямого совместного использования данных и вычислений. Допустим, я на равных правах могу попросить кого-то другого разрешить мне использовать его CPU, GPU или хранилище данных, или задать какие-то вопросы. То есть, это просто общение, как это происходит между людьми.

В идеале мы хотим исключить возможность наличия единой точки отказа, и это вытекает из первого свойства - отсутствия какого-либо центрального органа.

Далее следует резервирование. В идеале одноранговые участники сети должны быть взаимозаменяемы, чтобы при возникновении проблем с одним участником мы могли бы просто продолжить работу с другим. Это то, к чему мы стремимся.

И, конечно же, приватность. Честно говоря, это самое важное. Но здесь можно отталкиваться от личной ответственности за то, что сливаем в сеть. Исходя из этого, мы можем считать, что обеспечиваем свою приватность, просто не сливая ничего лишнего, ничего из того, что не хотели бы сливать. По сути, так и достигается приватность.

Теперь о противоположных типах сетей. Их два: сети могут быть относительно централизованными и децентрализованными. Почему относительно? Потому что это может быть реализовано тем или иным способом. В реальном мире она может быть децентрализованной, в неё будет входить множество компьютеров, но всё равно она будет оставаться централизованной, поскольку будет присутствовать некий распределённый центральный субъект, который будет управлять ею. Или же это может быть всего один компьютер, но будет утверждаться, что это целая децентрализованная сеть. Известно множество подобных примеров.

Далее - допуски, существующие в контексте централизованных сетей. По сути, в данном случае мы вынуждены слепо доверять. Именно это и происходит. Мы доверяем тому, кто предоставляет нам, допустим, HTTP-сервер. Программное обеспечение, запускаемое ими, обязательно будет хорошим, и никак не вредоносным. Другой способ добиться такого доверия - SSL-сертификаты и доменные имена. Допустим, если я захожу на сайт facebook.com, то это Facebook, и я могу проверить сертификат. Опять же, это тоже предполагает какое-то доверие какой-то организации, подписывающей такой сертификат. То есть, мы по-прежнему имеем дело с кем-то ещё.

Также существуют токены аутентификации. Токены аутентификации или авторизации широко используются для того, чтобы мы могли авторизовать какого-то пользователя на нашем сервере, если мы являемся сервером, или на этот конкретный сервер заходит какая-то личность. Это основные методы, которые применяются в самых разных случаях. Некоторые из них служат для защиты от DDoS-атак, некоторые - просто потому что так устроено изначально, или потому, что по-другому в этой среде нельзя.

Теперь о допусках, связанных с доверием, в контексте децентрализованных сетей. Как правило, они используют открытый исходный код. Безусловно, здесь мы ставим звёздочку, потому что в некоторых случаях это не так. Но предположим, что они используют открытый код, и мы можем прочитать его.

Затем мы широко используем подписи, позволяющие понять, с кем я говорю по сети, и без каких-либо сложностей подтвердить это. То есть используется прозрачная маска, известная каждому из нас.

И прозрачность, которая обеспечивается открытостью кода, подписанного разработчиком. И когда мы общаемся по сети, мы понимаем, с кем разговариваем. Это более или менее то, что мы ожидаем получить. Это не чёрный ящик. Это нечто открытое. Мы можем зайти и всё увидеть в любое время.

Теперь обратимся к общим проблемам одноранговых сетей? Очевидно, это качество обслуживания. Например, мы ожидаем, что сеть обеспечит нас возможностью, не знаю, чего именно - допустим, возможностью проведения встреч, прямого общения. Это довольно просто сделать. Вы просто предлагаете участникам сети способ непосредственного общения друг с другом. И всё. Но если нужно сделать что-то более сложное, скажем, соединение "многих со многими". Это сложно реализовать и сложно сделать это чисто, без какого-либо вовлечения централизованных организаций и тому подобного. Это что касается качества обслуживания.

Масштабируемость. Та же история - очень сложно масштабировать что-либо, скажем, до миллиона пользователей, 10 миллионов, миллиарда пользователей. Это то, к чему мы, по сути, стремимся, но о массовости пока речь не идёт, мы в поиске решения и медленно движемся в этом направлении.

Также актуальна проблема задержек, поскольку мы особо не контролируем одноранговые узлы, пропускную способность, сетевые интерфейсы и прочее. Бывает, что всё работает довольно вяло, и периодически мы с этим сталкиваемся.

Управление соединениями также является большой проблемой, потому что кто-то может находиться вне сети, и мы просто не сможем достучаться до него, не сможем настроить соединение, и в этом случае ничего не поделаешь.

И самое сложное, и это тема моего сегодняшнего выступления - это спам и защита от DDoS. Как обеспечить такую защиту так, чтобы никто не указывал нам: "Вы можете получать сообщения или данные от этого человека, с этого IP, но с этого IP вы получать сообщения не можете". Как сделать это децентрализованно, чтобы никто не управлял процессом, то есть исключить возможность возникновения единой точки отказа?

Как это обеспечивается в случае с централизованными сетями. В централизованной сети это делается с помощью токенов доступа, генерируемых для API. То есть всё просто. У вас есть какой-то объём данных - вот ваш токен. Обращайтесь ко мне с его помощью. А позже мы можем продлить его действие. Вот и всё. С точки зрения пользователя всё выглядит немного иначе. Существует токен авторизации или токен аутентификации. Суть идеи та же. Вы авторизуетесь, получаете токен, а затем обращаетесь ко мне, используя эту конкретную строку. И если она действительна - всё отлично. Если нет - до свидания.

И оценка надёжности IP. Это делается скорее на инфраструктурном уровне, когда, скажем, поведение IP-адресов ботнетов не соответствует шаблону, является неверным, и такие адреса отключаются. Мы просто перестаём получать с них данные. Это очень легко сделать: просто накладывается маска и не требуется никаких вычислений.

В случае с децентрализованными сетями сейчас используется механизм оценки одноранговых узлов, что можно рассматривать качестве защиты от DDoS. То есть если мы видим, что узел ведёт себя как-то неправильно. Допустим, я даю вам некоторый набор протоколов, набор сетевых ресурсов, и вижу, что вы каким-то образом злоупотребляете ими. Мы можем реализовать другие протоколы, которые будут отслеживать такое поведение и просто исключать из сети узлы, ведущие себя некорректно. Опять же, это всё ещё очень ненадёжно, так как узлы могут просто создать новый профиль. Не знаю, новый кошелёк или адрес кошелька, просто что-то новое - новый идентификатор узла. И всё - спам продолжается.

Также можно воспользоваться подходом на базе токенов. Это очень просто реализовать на уровне одноранговых узлов или на сетевом уровне. Во втором случае это сложнее, поскольку возникает необходимость в к каком-нибудь распределённом хранилище данных, позволяющем убедиться, что токен по-прежнему действителен. В связи с этим в определённый момент придётся производить множество обновлений, создавать, повторять попытки, удалять. И мы не хотим этого делать, поскольку по мере разрастания сети, по мере добавления в неё одноранговых узлов, мы не сможем с этим справляться.

В связи с этим мы предлагаем ограничивать скорость в нуллификаторах. Это именно то, что мы исследуем в рамках проекта Waku и Vac, исследовательской группы, которую мы создали вместе с одной организацией, занимающейся вопросами приватности и масштабируемости. Если в двух словах, это магия zk, которой, как известно, можно доверять. И вот, как производится ограничение скорости с помощью нуллификаторов.

Первый шаг: для того, чтобы стать участником распределённой сети, требуется создать некий профиль. Это не какой-то профиль, позволяющий идентифицировать вас. Это секрет, создаваемый под каким-то, в данном случае, контрактом - да, пока что совместимым с EVM. Но мы обязательно разберёмся с этим позже. Итак, необходимо создать некий секрет, и делается это для того, чтобы на кону были какие-то деньги, чтобы вы не вели себя неправильно, чтобы было что-то, что вас сдерживало.

Затем этот секрет используется для создания доказательств для каждого пакета данных. Допустим, вы отправляете 10 пакетов в секунду. Вам нужно создать доказательство для каждого из них, для каждой части этого потока данных. Но в схему zk встраивается только определённое количество сообщений, пакетов данных, любых фрагментов данных - как угодно, и только для определённого количества таких пакетов могут быть сгенерированы доказательства. Скажем, в секунду, за одну эпоху - в нашем случае на данный момент это секунда - в секунду вы можете сгенерировать только пять сообщений. Любой узел в сети может сгенерировать только пять пакетов данных. В случае Waku это 150 килобайт, что нормально. Итак, каждую секунду пять пакетов. И если вы генерируете шестой, то в этот момент любой, кто получил ваш пакет данных, а в сети Waku каждый получает ваш пакет данных по определённой теме, о чём я расскажу позже, может извлечь ваш секрет, используя ту же самую схему zk. И как только секрет будет выведен, тот, кто его вывел, сможет через контракт взять деньги. Всё очень просто.

После этого все последующие доказательства становятся недействительными, потому что секрет больше не является частью этого анонимного пула, и уже нет ничего, что делает доказательства действительными. Любой, кто получит их после и будет проверять их в соответствии с таблицей секретов, где секреты, безусловно, не видны, увидит, что доказательства недействительны.

Это наше предложение, но пока что не закончили работу над презентацией. Я уже пару раз упомянул сеть Waku. Это именно то, над чем я сейчас работаю. Это уровень обмена данными, подходящий для любых приложений web3. Это уже работает - в сети около 500 узлов или даже больше. Статистика открыта. Если вы поддерживаете собственный узел, вы можете увидеть сеть, объём обмена данными или количество узлов в сети. И мы обеспечиваем уровень обмена данными, не требующий каких-либо разрешений, и любое ваше или инфраструктурное приложение - и это касается не только приложений - может использовать его для обмена данными между точками A и B.

И немного истории. Всё началось в 2013 году, когда появился Ethereum, у которого было три столпа. Все вы, наверное, слышали о них: протокол консенсуса Ethereum, Swarm для обмена данными и Whisper для общения. И в то время Whisper был довольно неплох. Во всяком случае, лучше ничего не было. И до 2019 года не было никакого особого развития. Всё и так работало достаточно хорошо - его даже использовали некоторые проекты, некоторые протоколы. Всё было нормально.

А в 2020 году появился Status, приложение для обмена сообщениями, и стало очевидно, что развитие протокола просто - он должен был стать лучше. В первой итерации эвристика была настолько упрощена, что её было просто необходимо пересмотреть, что мы и сделали.

Так мы пришли к первому варианту реализации Waku и переделали его, взяв libp2p в качестве технологического стека, и добавив некоторые настройки сверху. Нам удалось добиться повышения пропускной способности, чтобы наши устройства не перегревались. Теперь не приходилось тратить гигабайты данных в секунду на ретрансляцию. То есть всё было хорошо, но не идеально.

Мы продолжили совершенствование, и написали варианты реализации на трёх других языках - JavaScript, Nim и Go. На них имеются соответствующие ссылки. Вариант Nim - лучший из них, и вы можете сами убедиться в этом. Сегодня мы продолжаем всё совершенствовать и стремимся к тому, чтобы это стало стандартом, используемым по умолчанию, потому что всё, что мы разрабатываем, открыто - каждый протокол открыт, и мы пытаемся стандартизировать их для многих других вариантов применения, таких как интернет вещей, соединение кошелька с кошельком и прочее.

А теперь краткий обзор протоколов. Любая одноранговая сеть начинается с обнаружения. Этот шаг никак нельзя пропустить. Вы либо уже знаете кого-то, с кем хотите связаться - это может быть сеть или веб-сайт - либо вам нужна помощь в обнаружении. Обычно для этого используются загрузочные узлы. И мы используем такой, используем DNS Discovery - один из протоколов обнаружения.

Как только вы начнёте, продолжить будет довольно просто. Мы реализовали некоторые другие протоколы. Так, например, у нас есть поддерживается одноранговый обмен. И как только вы становитесь частью сети, вы можете начать общаться с ней и спросить, известны ли ей ещё какие-нибудь одноранговые узлы, и если да, попросить поделиться адресом. И уже после этого можно попытаться установить соединение или сохранить его для дальнейшего использования. Возможно, какой-то узел окажется "долгожителем", и вы сможете воспользоваться им завтра, через месяц и так далее.

Также поверх Waku нами была реализована ещё одна сеть, которая является форком Ethereum Node Discovery V5, то есть это Waku V5, протокол Waku Discover V5, который так и называется. Мы внесли некоторые изменения, и это параллельная сеть, которая используется вместе с Waku, что обеспечивает большую стабильность для обхода шагов на этапе обнаружения и делает сеть более надёжной.

Что касается ретрансляции, Waku использует протокол libp2p GossipSub. Если вы не слышали о нём, по сути, это спецификация, согласно которой, если вы получаете сообщение в рамках одной заданной темы, вы просто передаёте это сообщение другим узлам, от которых оно получено не было. Понятно, что всё это работает неидеально, и даже довольно глупо, поскольку отсутствует какая-либо возможность масштабирования.

Уже существует множество итераций GossipSub, и сейчас, по-моему, мы используем GossipSub V2. Протокол довольно хорош, и мы продолжаем совершенствовать его, пытаясь найти плюсы и минусы, в частности хороший с точки зрения Waku компромисс.

Поверх GossipSub мы реализуем шардинг, поэтому нет одной большой темы, с которой работала бы вся сеть. Есть несколько её подразделов, и согласно нашим эмуляциям, мы добились масштабируемости до миллиона пользователей или даже больше. И давайте посмотрим, как это происходит. Здесь используется архитектура Pub/Sub, то есть вы просто подписываетесь и получаете сообщения из сети.

Я уже упоминал RLN, протокол, реализованный параллельно с работой над обеспечением приватности и масштабируемости. Мы продолжаем совершенствовать его. Уже существует контракт, совместимый с Ethereum EVM, который может быть развернут в любом EVM-совместимом блокчейне. Сейчас он также развернут в Sepolia, и мы работаем над тем, чтобы этот примитив можно было использовать как взаимозаменяемый и даже отдельно от Waku. Это не наша собственность - всё открыто, код выложен в общий доступ. Просто возьмите его и используйте в своём проекте. Помимо одноранговой сети у алгоритма есть множество других применений. Он может быть использован на прикладном уровне, что очень хорошо.

Что касается лёгких протоколов, мы никогда не забываем о лёгких клиентах, используемых телефонами, браузерными вкладками и так далее. Это то, что мы реализовали специально для них, поскольку GossipSub довольно сложно запустить в браузере, в мобильном устройстве или где-нибудь ещё. Поэтому мы просто используем процедуру запроса-ответа. Все знают этот шаблон. Он хорош, он работает.

И немного о свойствах, которые обеспечивают эти протоколы. Мы по умолчанию приватны. Это всё, к чему я подводил, - всё встроено, все функции обеспечения приватности встроены в каждый кусок кода, который мы пишем. И это подтверждается спецификациями, которые мы разрабатываем и проверяем. Нет никаких особых прав доступа - любой может присоединиться к сети, любой может стать её участником и влиять на её работу на уровне обнаружения, на уровне предоставления услуг, а также просто использовать её для своих нужд и не предоставлять ничего сверх того, что хотел бы предоставить. Благодаря шардингу, благодаря RLN, нами обеспечивается масштабируемая безопасность. Безусловно, ещё многие вопросы требуют решения, и мы будем рады любой помощи. Кроме того, наша сеть дружелюбна к Litecoin. Мы не забываем о них и разрабатываем специальные протоколы.

Да, и почему мы вообще всем этим занимаемся? Воспользовавшись этим QR-кодом, вы сможете ознакомиться с нашими принципами и ценностями, как с точки зрения исследований, так и разработки. Мы верим в суверенитет личности и считаем, что его можно достичь, только сделав прозрачным каждый кусок кода, который мы пишем, любое программное обеспечение, которое мы разрабатываем, а также каждое исследование, которое мы проводим.

На этом у меня всё, спасибо.
