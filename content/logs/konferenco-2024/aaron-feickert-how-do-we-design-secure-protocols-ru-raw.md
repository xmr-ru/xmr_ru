---
title: "Аарон Фейкерт - Как мы разрабатываем протоколы безопасности?"
date: "2024-06-07"
categories:
  - "Стенограмма"
tags:
  - "MoneroKon 2024"
lead: "Monero Konferenco 2024 #MoneroKon2024 Прага"
pager: true
toc: false
sidebar: "right"
---

{{< youtube id="MW-yfEO5AZY" autoplay="false" >}}

---

_**Аннотация выступления**_

Когда мы рассматриваем такие криптографические протоколы, как CLSAG и Bulletproofs, Triptych и Seraphis, мы часто говорим о таких вещах, как модели безопасности и доказательства. Но что всё это значит?

В этом выступлении мы вкратце рассмотрим, что значит построить безопасный криптографический протокол и проанализировать его. Используя подход, ориентированный на Monero, мы представим идею модели безопасности и на примерах из экосистемы Monero покажем, почему она является важной частью анализа таких конструкций.

Этот доклад позволит вам получить более широкое представление о том, что именно криптографы делают за кулисами, чтобы обеспечить безопасность Monero.

_**Стенограмма выступления:**_

_**Лиам:**_ В моём выступлении не будет математики, не переживайте. Скоро обед, и лучшее выступление перед обедом - это короткое и лёгкое выступление. Лучше может быть только просто короткое. Так что я постараюсь сделать своё выступление коротким и лёгким.

Итак, поговорим немного о... да, конечно же, это не финансовый или какой-либо другой совет. Итак, когда мы говорим о криптографических конструкциях, а их много, речь идёт о схемах подписи, таких как CLSAG и Monero, или Bulletproofs, Bulletproofs+, Bulletproofs+++, которые мы используем, например, для доказательства диапазона, или даже для протоколов транзакций, таких как Seraphis от Monero, или Spark - похожий протокол, над которым я работал. Мы часто говорим о безопасности и доказательстве безопасности. Но мы почти не говорим о том, что это значит. Поэтому мы очень кратко рассмотрим некоторые методы, которые можно использовать для доказательства криптографической безопасности.

Существует множество различных способов формализовать криптографическую конструкцию так, чтобы проанализировать её безопасность и доказать, что она безопасна. И я приведу несколько стратегий, которые для этого используются. Это будет далеко не полный список. Существует множество различных способов, концепций и методов доказательства безопасности. Мы же сосредоточимся на одной конкретной области на основе конкретных примеров, в частности на примере Monero. И если вы уже знакомы с ними на техническом уровне, вы скажете: "Ну, это далеко не всё". Да это далеко не всё, но этого и не предполагалось. Это просто краткий обзор.

Итак, возьмём в качестве примера цифровую подпись. Схема подписи - это криптографическая конструкция, которая используется для проверки подлинности сообщений. Такие схемы используются очень часто. Они используются в Monero, они используются в Bitcoin. Вы используете их постоянно, всякий раз, когда пользуетесь своим телефоном для аутентификации сообщений с помощью ключей. Основная идея заключается в том, что если у меня есть ключ подписи и сообщение, которое я хочу подписать, то я как подписывающая сторона могу криптографически создать подпись. А у вас, желающего проверить подпись, есть соответствующий ключ верификации. Вы берёте ключ верификации, сообщение, созданную мной подпись и определяете, является ли эта подпись подлинной, действительной или нет.

И чтобы формально проанализировать безопасность любой схемы подписи, нам необходимо формализовать и разбить её на различные алгоритмы. И на примере подписи криптографически мы обычно делаем это с помощью трёх разных алгоритмов. Первый - алгоритмы генерации ключа подписи и ключа верификации. Как выглядят эти алгоритмы, зависит от того, какая конструкция подписи была выбрана. Затем следует алгоритм подписи, который я использую для получения ключа подписи и сообщения, которое я хочу подписать. Он выдаёт подпись, используя математические или криптографические методы, предусмотренные различными схемами. Также существует соответствующий алгоритм верификации, который берёт мой ключ верификации, берт сообщение, подпись и выдаёт "да" или "нет", то есть, определяет, действительна подпись к этому сообщению для данного ключа или нет.

Теперь, чтобы доказать безопасность алгоритмов, формализованных нами  в данной схеме подписи, нам нужно формализовать так называемую "модель безопасности". И в данном случае модель безопасности охватывает те свойства, которыми она, по моему мнению, должна обладать, и указывает на то, как я могу их формализовать их контексте так называемых "игр безопасности" с участием злоумышленника, желающего взломать свойства моей схемы. То есть каждое свойство, которое мы решили сформулировать в рамках модели безопасности, связано с игрой, которую мы должны определить, и в которой мы играем против злоумышленника. И если злоумышленник может победить в определяемой нами игре, значит, он может взломать какое-то из свойств, а это плохо. Мы этого не хотим. То есть мы используем доказательство безопасности, чтобы показать, что не существует злоумышленника, способного победить в игре, и что наша схема безопасна. Поэтому, когда мы говорим о безопасности, мы делаем это в контексте определяемой нами модели безопасности.

Одно из свойств, которым, как правило, должны обладать подписи, - невозможность подделки. Это понятно даже на интуитивном уровне: я не хочу, чтобы подписи можно было подделать без ключа подписи. При отсутствии ключа подписи не должно быть возможности создать подпись, которую можно было бы выдать за настоящую. Поэтому мы формулируем игру подделки и играем в неё против гипотетического криптографического злоумышленника. Его цель будет состоять в том, чтобы, не зная ключа подписи, создать действительную подпись под некоторым сообщением, которое мы считаем легитимным. Он не должен быть в состоянии сделать это. Это и есть подделка. Если злоумышленник не может победить в этой игре - отлично! Значит, конструкцию подписи подделать нельзя. Но это только часть нашей модели безопасности, поскольку есть и другие свойства, которые нам могут понадобиться.

Итак, как мы формулируем эту игру? Игра ведется между нами и злоумышленником, и в ней есть разные этапы. На первом этапе мы генерируем ключ подписи и ключ верификации, но даём злоумышленнику только ключ верификации. Если бы у него был ключ подписи, то, конечно же, он мог бы подделать сообщение. Вот как это работает: злоумышленник передаёт сообщение и говорит: "Пожалуйста, подпишите сообщение". Обладая ключом подписи, мы подписываем сообщение и передаём злоумышленнику подпись. И злоумышленник может делать ровно это столько раз, сколько захочет. Он может снова и снова передавать нам сообщения, и мы будем подписывать их и передавать обратно. А в конце игры злоумышленник передаст новое сообщение, которое он не отправлял нам ранее, и запрошенную подпись. И злоумышленник выигрывает, если подпись действительна. Итак, всё, что у него есть, - ключ верификации и куча подписей, которые он попросил нас сделать. А затем он отправляет нам новую подпись, которую пытается подделать.

Стоит отметить, что в этой игре мы наделяем злоумышленника некоторыми полномочиями. Первое - мы даём ему ключ верификации, что вполне логично. В реальности, скажем, в случае с блокчейном, для того, чтобы проверять транзакции, всем, всей сети, всему миру, необходим доступ к ключам верификации. Поэтому имеет смысл дать такой ключ и злоумышленнику. Также мы даём ему возможность попросить нас подписать любое сообщение на выбор. В контексте подписи в блокчейне это эквивалентно просьбе подписать какое угодно сообщение. Это может быть что-то вроде схемы входа в систему или аутентификации. Злоумышленник может обманом заставить нас отправить транзакцию кому бы то ни было на своё усмотрение.

Идея заключается в том, что полномочия, которыми злоумышленник обладает в определяемой нами игре, должны максимально отражать условия реального мира, поскольку модель безопасности имеет смысл в реальном мире только в том случае, если вы правильно смоделировали его условия. То есть в рамках игры мы стараемся наделить злоумышленника как можно большим количеством реальных возможностей.

И теперь нам нужно создать доказательство безопасности. Невозможность подделки, о которой мы говорили, является очень общим свойством. Всё, что нам нужно, - иметь представление о подписи и проверке. А для этого есть множество различных способов. Подписи ECDSA, например, используются в Bitcoin. Подписи Шнорра, их разновидность, используются в Monero. Вы можете создавать подписи RSA - самые разные варианты. Но если это свойство и игра являются общими для идеи схем подписи в целом, то доказательство безопасности, которое необходимо создать, чтобы продемонстрировать, что нет такого злоумышленника, который мог бы победить в этой игре, очень специфично для любой выбранной вами схемы безопасности, будь то ECDSA, подписи Шнорра или что-то другое. Идея состоит в том, чтобы показать, что злоумышленник сможет победить в этой игре подделки, в рамках которой он передаёт нам поддельную подпись, то мы сможем использовать это для решения другой криптографической задачи, которая считается трудной. В криптографии существуют идеи сложных задач, и мы хотим показать, что можем свести нашу игру к известной сложной задаче.

Идея заключается в том, чтобы обмануть злоумышленника, смоделированного нами же, и заставить его решить эту сложную задачу, победив в нашей игре. Одна из распространенных схем подписи называется подписью Шнорра. В этом случае сложная задача является криптографической и называется "задачей дискретного логарифмирования". Её суть заключается в том, что вы можете "обратить" ключи, то есть взять ключи верификации и превратить их обратно в ключи подписи. Если бы эта задача была решена, а спустя десятилетия исследований считается, что она не решается, это привело бы к катастрофическому сбою интернета, мир погрузился бы в хаос и всё такое.

Итак, сложная задача, которую мы рассмотрим, называется "задачей дискретного логарифмирования". Для неё есть отдельная игра. Идея этой задачи заключается в том, что мы должны быть в состоянии получить так называемый "дискретный логарифм". Таким образом, если мы докажем, что в нашем случае подписи Шнорра безопасны, доказательство невозможности подделки также продемонстрирует, что мы можем выиграть эту проигрышную игру с дискретным логарифмом, передавая в игре подделки информацию между нашим злоумышленником и как бы всем миром. Идея состоит в том, что если бы злоумышленник смог победить в этой игре, мы могли бы использовать её для решения нерешаемой задачи. Это математическое противоречие. И если это так, то это означает, что такого злоумышленника быть не может. И доказательство формально подтверждает, что это так путём формализации того, как эти игры безопасности взаимосвязаны.

Стоит отметить, что на самом деле мы не знаем наверняка, являются ли такие сложные задачи, как задача дискретного логарифмирования, нерешаемыми. Просто десятки лет исследований показали, что это так. Поэтому частью формулирования модели безопасности является определение тех задач, которые считаются нерешаемыми. Задача дискретного логарифмирования - одна из них. Она упоминается, например, в документе Bulletproofs++.

Пример Monero - подпись CLSAG. В настоящее время в Monero для авторизации транзакций используется другая разновидность подписи, называемая "связываемой кольцевой подписью". Поэтому мы часто говорим, что Monero использует кольцевые подписи. И именно такую кольцевую подпись использует Monero. По сути, вы подписываете сообщение от имени группы возможных подписантов. Эта подпись также обладает свойством невозможности подделки, которое как бы связано с таким же свойством стандартных схем подписи, но немного изменено. И для этого свойства, исключающего возможность подделки, есть игра, в рамках которой злоумышленник должен создать подпись, используя список возможных ключей. Идея похожа. Злоумышленник побеждает в игре, если сможет создать новую подпись, в которой различные части ключей подписи будут ему не известны.

И когда мы с коллегами изначально создавали доказательство для подписи CLSAG, игра требовала, чтобы список ключей, использованных злоумышленником для создания своей подписи, был сгенерирован честно. Но в условиях реального мира это не обязательно будет так. В контексте, скажем, Monero, для совершения транзакции вам не нужно обращаться к кому-то и запрашивать ключи верификации и подписи. Нет, вы генерируете их сами. И если вы злоумышленник, вы можете попытаться сгенерировать эти ключи со злым умыслом.

Изначально наша модель безопасности, как и многие другие до неё, основывалась на идее, что ключи генерируются честно. К счастью, аудиторы указали на то, что этот сценарий, вероятно, не идеален. Они порекомендовали изменить игру так, чтобы злоумышленник мог подбрасывать в конструкцию любые ключи, что наделяло бы его более реалистичными возможностями. И тогда мы изменили доказательство безопасности так, чтобы учесть и такой сценарий. Таким образом, мы получили отличный пример того, как различные возможности злоумышленника, которыми он обладает в реальном мире, могут повлиять на модель безопасности.

Теперь рассмотрим другой пример - доказательство диапазона, о котором мы говорили ранее, когда речь шла о Bulletproofs++. Чтобы показать, что транзакция сбалансирована и что деньги не создаются из воздуха, необходимо использовать так называемое доказательство диапазона. Идея доказательства диапазона заключается в подтверждении того, что суммы, которые вы скрываете внутри различных элементов транзакции, являются действительными и не являются отрицательными. В Monero это делается следующим образом: берётся сумма, ей присваивается значение, далее берётся случайная так называемая "маска", всё это объединяется и формируется криптографический блоб под названием "обязательство", скрывающий сумму. При этом всё делается очень структурированным способом.

Идея заключается в том, чтобы представить это доказательство диапазона с помощью того так называемого "доказательного отношения". Доказательное отношение - это довольно общий термин, который показывает, как различные открытые и секретные данные соотносятся и взаимодействуют в системе доказательств. Так, в случае доказательств диапазона, где используются эти обязательства, открытые данные, которые видны всем как часть транзакции, - это обязательство, криптографический блоб, который представляет сумму в скрытом и структурированном виде. А секретные данные - это представленное значение и случайная маска, которая используется для создания блоба. Таким образом, отношение между секретными и открытыми данными обязательств в доказательствах диапазона заключается, во-первых, в том, что обязательство создаётся с помощью секретного заданного значения и маски и, во-вторых, в том, что значение, скрыто представленное в нём, находится в допустимом диапазоне, который не является отрицательным, поскольку такого просто не может быть.

И свойства безопасности, которые мы используем в системах доказательства, таких как Bulletproofs, Bulletproofs+, Bulletproofs++++, сводятся к тому, что доказывающая сторона использует секретные данные для построения своего доказательства, а затем верификатор, который может быть любым участником сети, любым человеком в мире, для проверки доказательства использует только открытые данные. Ему неизвестны секретные данные. Они скрыты.

При этом существует несколько свойств безопасности, которыми обладает доказательство диапазона. Одно из них называется "полнотой". Согласно ему, если доказывающей стороне действительно известны секретные данные, используемые для построения доказательства диапазона и обязательства, то верификатор точно сочтёт доказательство правильным. Таким образом, честные доказательства являются честными и действительными. Второе - это "обоснованность", и Лиам вскользь упоминал о нём в своем выступлении. Согласно этому свойству, если доказывающей стороне не будут известны секретные данные, используемые для построения обязательства, в данном случае это значения и маски, то верификатор всегда отклонит такое доказательство. То есть вы не сможете подделать доказательство, если не знаете секретных данных. Третье часто используемое свойство называется "нулевым разглашением". Неформально это означает, что верификатор не сможет узнать секретные данные, глядя на доказательство. Существуют точные технические определения этого свойства, но мы не будем рассматривать их сегодня.

Как правило, чтобы показать, что обоснованность соблюдена, то есть доказывающей стороне известны секретные данные, и она не может подделать доказательство, требуется построить алгоритм под названием "экстрактор". Это алгоритм, который, по сути, притворяется верификатором, но алгоритмически и технически просит верификатора сгенерировать кучу разных доказательств для одних и тех же данных очень специфическим техническим способом. А затем экстрактор показывает, что если бы у него был доступ ко всем этим доказательствам, он мог бы взять и извлечь секретные данные. И вы можете использовать этот подход, чтобы утверждать, что если этот экстрактор может извлечь секретные данные из набора доказательств каким-то структурированным способом, то доказывающей стороне это должно было быть известно. Очень распространённая техника доказательства - взять набор доказательств и продемонстрировать, что вы в состоянии извлечь из них секретные данные.

За всю историю своего существования Monero использовала три различных вида кольцевых подписей. В первом случае использовалась вариация кольцевых подписей под названием "кольцевые подписи Борромео". Второй вид - Bulletproofs с более эффективной системой доказательств диапазона. И третий вид, используемый сегодня, - Bulletproofs+, представляющие собой по-иному структурированную и более эффективную версию Bulletproofs. Все они обладают одними и теми же тремя свойствами: полнотой, обоснованностью и нулевым разглашением, но каждое из них доказывается разными способами.

Таким образом, свойства безопасности, подобные тем, о которых мы говорили в контексте подписей, применимы в к множеству различных систем доказательств в целом, а не только к доказательствам диапазона. Всё, в сущности, нужно, - это доказательное отношение, в котором присутствуют некоторые открытые данные, некоторые секретные данные и некоторая связь между ними.

Почему же мы выбираем именно эти свойства, а именно полноту, обоснованность и нулевое разглашение? Ну, прежде всего потому, что мы можем складывать их и строить гораздо более сложные системы. Так, например, система доказательства диапазона является частью протокола транзакций Monero, который в настоящее время называется RingCT. Он включает в себя доказательство диапазона, обязательства, различные методы демонстрации баланса. Так, например, нам нужны кольцевые подписи. Все они взаимодействуют и обладают различными свойствами безопасности.

Идея заключается в том, что более сложная криптографическая конструкция, такая как RingCT, Seraphis или Spark, например, протокол транзакций, будет использовать такие криптографические строительные блоки, как доказательства диапазона и связываемые кольцевые подписи, каждый из которых обладает известными и понятными свойствами безопасности. И это хорошо потому, что это делает анализ простым и структурированным. Например, чтобы при заданной модели безопасности доказать, что протокол RingCT или Seraphis, или какой-то другой безопасен, мы можем посмотреть на свойства безопасности строительных блоков, таких как кольцевые подписи и доказательства диапазона. И самое замечательное во всём этом - модульность. Например, как уже было сказано, у Monero использовала три разных варианта доказательств диапазона. Поскольку, например, Bulletproofs и Bulletproofs+ обладают одинаковыми свойствами безопасности - полнотой, обоснованностью и нулевым разглашением, это означает, что если достаточно тщательно следить за тем, как всё делается, можно извлечь одну из конструкций и заменить её на новую с теми же свойствами безопасности, что, собственно, и происходит. Когда протокол Monero перешел от использования Bulletproofs к Bulletproofs+, Bulletproofs просто был заменён на Bulletproofs+. Мы знали, что у них одинаковые свойства безопасности у них одинаковые, поэтому безопасность всего протокола транзакций RingCT сохранялась. И это просто круто.

И оказывается, что, когда мы говорили о подписях Шнорра и доказывали безопасность через свойство невозможности подделки, оказывается, можно использовать подобную технику построения даже для доказательства безопасности таких структур, как подписи Шнорра. Так что таким образом можно делать много интересного.

Но это ещё не все. Всё это похоже на рекламу или что-то вроде того. Но, как было сказано, это лишь одна очень маленькая часть того, как может быть доказана безопасность определённых типов криптографических систем. На самом деле существует целая вселенная различных методов и подходов к доказательству безопасности. А это просто довольно специфический срез одного очень специфического метода доказательства безопасности систем. Так что этот пример ни в коем случае не является полным и окончательным. Но даже на его основе можно сделать несколько полезных выводов.

Первый заключается в том, что доказательство безопасности хорошо ровно настолько, насколько хороша модель безопасности. И помните, что модель безопасности определяет, в какой мере злоумышленнику будет позволено взаимодействовать с системой и пытаться взломать определённые свойства. Если свойства определены плохо, или если игра безопасности плохо сформулирована, доказательство безопасности не будет иметь ничего общего с тем, как система будет работать в условиях реального мира. Поэтому, когда кто-то говорит: "Я доказал безопасность системы", первое, о чём вы должны подумать: в рамках какой модели безопасности? Ответа на ваш вопрос не последует. Пожалуй, это скверный признак.

Также интересно то, что даже достоверное доказательство безопасности при наличии плохой модели безопасности может быть достоверно технически, но это мало что говорит о том, что будет происходить в реальном мире. И здесь можно использовать пример с подписями CLSAG. Когда поначалу ключи генерировались честно, мы доказали, что они безопасны в рамках такой модели безопасности. Но это не отражало того, что могло случиться в условиях реального мира. Поэтому так полезно изменение модели безопасности на более реалистичную.

Второй вывод: как уже было сказано, некоторые общие свойства безопасности полезны, поскольку помогают брать более простые системы, такие как система доказательства диапазона, например, или связываемая кольцевая подпись, и складывать их в более сложные системы, такие как протокол транзакций, которые гораздо шире.

И третий, заключительный и самый важный вывод: формальная безопасность - это очень и очень сложно. Формализация всех этих вещей, создание игр, составление доказательств безопасности - это очень, очень тонкий процесс. И очень легко ошибиться в едва приметных аспектах. Но такая формализация очень важна с точки зрения создания надёжных систем. Вот, пожалуй, основные выводы, связанные с доказательством безопасности систем и формализацией хорошей модели безопасности.

У нас осталась одна минута, так что спасибо всем вам. Эти слайды будут выложены на GitHub после конференции на случай, если вы захотите взглянуть на них ещё раз, покритиковать или с какой-то другой целью. И если у вас есть вопросы, обязательно напишите мне или найдите меня после конференции. Спасибо за внимание.
