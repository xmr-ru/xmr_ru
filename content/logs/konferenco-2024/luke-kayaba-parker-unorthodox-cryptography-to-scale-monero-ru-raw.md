---
title: "Люк 'Kayaba' Паркер - Применение неортодоксальных криптографических методов в контексте масштабирования Monero"
date: "2024-06-07"
categories:
  - "Стенограмма"
tags:
  - "MoneroKon 2024"
lead: "Monero Konferenco 2024 #MoneroKon2024 Прага"
pager: true
toc: false
sidebar: "right"
---

{{< youtube id="UwIV8DecD0w" autoplay="false" >}}

---

_**Аннотация выступления**_

Ожидается, что Monero эволюционирует до Seraphi и будет использовать JAMTIS в качестве новой адресной схемы, а еще внедрит доказательства участия на основе полного блокчейна для обеспечения еще больщей конфиденциальности отправителя. Все это опирается на криптографию эллиптических кривых, наиболее известной конструкцией которой является цикл кривой (эллиптическая кривая, скалярное поле которой встраивается в поле эллиптической кривой, скалярное поле которой является полем исходной кривой).

В этом докладе будут рассмотрены альтернативные криптографические схемы, которые могут предложить более производительное доказательство участия, снизить требования к хранению, устранить необходимость итеративного сканирования транзакций для почти мгновенного времени подтверждения и повысить конфиденциальность для пользователей, которые не управляют собственными узлами.

_**Модератор:**_ Следующая презентация посвящена альтернативным криптографическим схемам, позволяющим строить производительные доказательства участия, снизить требования к хранению данных Monero, устранить необходимость итеративного сканирования транзакций и повысить уровень приватности пользователей, не поддерживающих собственных узлов. Ещё раз поприветствуем - Люк Паркер.

_**Люк:**_ Привет, для тех, кто пропустил утреннее выступление, представлюсь: меня зовут Люк Паркер. Тема моей презентации - "Применение неортодоксальных криптографических методов в контексте масштабирования Monero".

Большинство из вас уже знают, но я просто напомню, что являюсь членом комитета фонда MAGIC. MAGIC - это американская благотворительная организация, освобождённая от федерального подоходного налога, и если вы платите налоги в США и хотите получить вычет за счёт пожертвований в пользу Monero, то фонд даёт отличную возможность сделать это. Также хотелось бы отметить, что для меня большая честь быть четырёхкратным участником MoneroKon. Посмотрим, как у меня получится в этот раз.

Итак, в настоящее время, как, возможно, вы уже слышали в рамках последнего выступления, которое, на мой взгляд, было представлено с известной долей юмора, ключевым криптографическим методом, используемым Monero, являются эллиптические кривые. Это быстрые, эффективные и безопасные (в условиях доквантового мира) группы, и здесь слово "группы" применяется в математическом контексте, лежащие в основе большинства современных криптографических схем. Они хорошо изучены и широко применяются. Они работают, и работают хорошо. Мы могли бы вернуться к RSA, но криптография Monero стала бы в 10 раз больше и работала бы в 100 раз медленнее. Так зачем нам это, если эллиптические кривые и так работают?

Но что, если мы хотим большего? Что, если нам нужно что-то, что не просто работает, а в разы превосходит всё остальное? Поэтому я начну с нескольких примеров того, чего мы хотим, и расскажу о том, как это сделать, то есть, превзойти все известные методы.

Итак, доказательства участия на базе полного блокчейна. В настоящее время для их реализации рассматривается возможность использования Bulletproofs. Bulletproofs - это доказательство на базе эллиптических кривых с временной сложностью O(n), обладающее размером O(log s). Жаль, если вы ранее не встречались с обозначением O, поскольку далее мы будем использовать именно его. По сути, оно означает, что если ваша программа совершает 100 операций, то их проверку потребует 100 единиц времени, но при этом будет занято пространство только для 10 разных операций, что гораздо меньше по размеру, но по времени будет эквивалентно.

И в будущем мы можем рассмотреть возможность перехода на другие доказательства, также основанные на эллиптических кривых, например Spartan. Самое замечательное в Spartan то, что этот протокол экономит не только место, но и время. При этом плохо то, что Spartan требует больше времени на выполнение каждого отдельного шага, а поскольку на выполнение каждого шага требуется больше времени, на практике это может не сработать, несмотря на использование меньшего количества операций. Каждая операция может оказаться настолько затратной, что такой переход не сработает.

С этого момента мне придётся немного углубиться в подробности, поэтому прошу прощения у тех, кто уже собирался расслабиться в конце дня. По сути, вместо того чтобы рассматривать логарифмические схемы, мы могли бы обратиться к криптографическим аккумуляторам. Криптографические аккумуляторы будут занимать всего O(1) как по месту, так и по времени, независимо от того, сколько данных будет обрабатываться. Теоретически это будет некая постоянная величина с точки зрения места и времени проверки. Также будет некий верификатор (log n), что также является конкурентным преимуществом, необходимым при наличии глобальной предварительной обработки. То есть, пока узел будет перебирать выходы, он просто произведёт такую предварительную обработку, а когда придёт время отправлять транзакцию, она уже будет готова.

Криптографические аккумуляторы могли бы стать идеальным способом доказательства участия на базе полного блокчейна. Но, к сожалению, исторически в их основе лежат RSA, а это именно то, что мы не хотим использовать в Monero. На одну операцию будет приходиться 384 байта вместо 32, которые мы получаем при использовании эллиптической кривой. Таким образом, она будет в 10 раз больше, и нам придётся использовать доверительные настройки.

Если не использовать таких настроек, то приходится прибегать к схеме, известной как RSA UFO. К сожалению, она не была передана нам инопланетянами. RSA UFO расшифровывается как "RSA с неизвестной факторизацией". И это означает, что в отличие от традиционного открытого ключа RSA, который кто-то генерирует и выдаёт его в никуда, мы случайным образом генерируем супербольшое число, потому что статистически в супербольшом числе в какой-то момент окажутся два простых числа достаточной длины, которые никто не знает. И чтобы случайно сгенерировать большое число, в котором окажутся эти два очень больших простых числа, оно должно составлять 46 килобайт, что в 20, 30, 40 раз больше, чем любая транзакция Monero сегодня. Так что эта идея также нам совершенно не подходит.

И это подводит нас к последнему варианту. Мы можем использовать группы классов. Группы классов не предполагают наличия доверительных настроек, и благодаря их отсутствию они также не занимают 46 килобайт. На деле они занимают всего пару сотен байт. И поскольку они занимают пару сотен байт, полное доказательство, построенное вокруг них, будет примерно в шесть раз меньше, чем предлагаемое сегодня. Предлагаемое сегодня доказательство линейно по времени проверки относительно размера программы, но это кумулянтное доказательство будет O(1). Независимо от того, насколько велик набор выходов, доказательство того, что выход, который мы тратим, на самом деле входит в набор, займёт одно и то же количество времени.

А дальше всё довольно быстро сходи на нет. Несмотря на размер проверяемого доказательства, равный O(1), мы итак получаем логарифмическую верификацию с помощью Bulletproofs уже только потому, что мы не кодируем линейную программу. Мы кодируем логарифмическую программу. И на практике это всё равно будет работать намного медленнее, чем доказательство Bulletproof. На практике оно будет не только медленнее, но и заметно меньше. У групп классов есть одно очень интересное свойство. Если вы хотите, чтобы их безопасность обеспечивалась 128 битами, требуется только 1800-битный дискриминант в кавычках. Дискриминант подразумевает конфигурирование числа группы классов. Проблема состоит в том, что при использовании 1800-битного дискриминанта действительно обеспечивается 128 бит безопасности, за исключением очень редких случаев, когда безопасность нарушается. И вы не узнаете, действительно ли безопасность была критически нарушена, пока по факту не попытаетесь его взломать. И, само собой, потратив 100 бит на взлом, вы поймёте, что на самом деле он не был 128-битным.

Поэтому для того, чтобы получить глобально используемую, способную продержаться следующие 10 лет, способную выжить в будущем группу классов, нам нужно выбрать гораздо большее число. Только в этом случае вероятность критического нарушения безопасности будет минимальной. То есть, число должно быть в четыре-пять раз больше. Это по-прежнему меньше, чем в случае с рассматриваемыми сегодня доказательствами, но не так привлекательно, как уменьшение в шесть раз.

Также с практической точки зрения для групп классов придётся реализовать ряд криптографических схем. Речь идёт не об эллиптических кривых. Это будет целый набор библиотек, понадобится целый ряд аудитов. И хотелось бы, чтобы в будущем особое внимание уделялось мета-доказательствам и разработке мета-доказательств. Мета-доказательства - это такие доказательства доказательств, необходимые для повышения эффективности в будущем.

В случае с эллиптическими кривыми мы хорошо себе представляем, как создавать такие мета-доказательства в кавычках. В частности, речь идёт о цикле кривой, то есть, б эллиптической кривой, скалярное поле которой является полем другой эллиптической кривой. Это уже сложнее, но суть состоит в том, что мы знаем, как вполне эффективно работать с эллиптическими кривыми внутри других эллиптических кривых. А вот чего мы не можем сделать, так это в случае, если мы когда-нибудь представим доказательство группы классов, то не сможем работать с этим доказательством внутри исходного мета-доказательства эллиптической кривой. Спустя годы мы всё ещё будем работать с этими группами классов, потому что в итоге нам придётся создавать мета-доказательство на основе групп классов для доказательств групп классов.

В итоге в случае с группами классов мы можем получить лучшие теоретические свойства и доказательства меньшего размера. Но это потребует больших усилий и, вероятно, не будет пропорционально затраченным усилиям.

Далее я хотел бы поговорить о синхронизации кошельков. Это одна из основных проблем, с которыми сталкиваются пользователи Monero. Я уверен, что если попрошу поднять руку тех, у кого когда-либо возникали проблемы с синхронизацией кошелька, многие сделают это. Вот - один, второй, третий…

Сегодня для этого приходится загружать выходы каждой транзакции и запускать процесс сканирования. Это линейный процесс. По мере увеличения количества выходов, увеличивается и время сканирования, как и затраты по пропускной способности, поскольку теперь придётся скачивать все эти выходы.

И когда Monero подверглась спам-атаке, это, к сожалению, некоторые кошельки и некоторые серверы не справились с этим. Насколько мне известно, Cake пришлось проделать большую работу, чтобы повысить эффективность и устойчивость своих серверов.

Опять же, если мы перейдём от криптографии на эллиптических кривых к методам, технически не связанным с RSA, но с тем же успехом это может быть и RSA, мы сможем получить скрытые адреса, проверка которых займёт O(1). Это означает, что при наличии миллиона выходов сразу же можно будет проверить, не адресован ли какой-нибудь из них вам. И если окажется, что это так, вы сможете немедленно разделить их. То есть, попытаетесь определить: первые 500 000 содержат предназначенный для вас выход, или это остальные 500 000? Есть ли среди них нужный вам выход? И если у вас есть один выход из миллиона, то вам потребуется сделать 25 запросов к серверу кошелька или около того, чтобы синхронизировать этот 1 миллион выходов. Так что это было бы очень эффективно и позволило бы кошелькам довольно быстро находить, какие выходы принадлежат им.

Плохие новости: уже существует схема, позволяющая это сделать. Это полноценный и уже проверенный протокол. Он требует регистрации в блокчейне, а это настоящая боль для пользователя. Если пользователь создаст адрес Monero, ему придётся регистрировать его в блокчейне. Ещё более серьёзная проблема заключается в том, что при проверке скрытые адреса допускают только одну попытку расшифровки. Но, как нам сегодня известно, в целом адреса не имеют постоянного размера. Но адреса Monero имеют. Одноразовые ключи всегда являются одной точкой на эллиптической кривой и всегда составляют 32 байта.

К сожалению, в случае с этими скрытыми адресами, проверка которых занимает постоянное количество времени, независимо от количества выходов, они имеют постоянный размер относительно количества потенциальных получателей. Так что если в блокчейне имеется миллион выходов, размер этого скрытого адреса будет составлять гигабайт, или, простите, мегабайт, или сотни мегабайт - где-то посередине. И это ужасно - мы не можем допустить, чтобы сотни мегабайт добавлялись в блокчейн с каждым выходом.

Кроме того, вопреки существующему мнению, это не обеспечит опережающей секретности. Опережающая секретность представляется мне важной проблемой. Она означает, что когда появится квантовый компьютер, он не сможет взять текущие транзакции Monero и отследить их. И эта схема, в том виде, в котором она представлена ни в малейшей степени не обеспечит какой-либо секретности. Так что, с одной стороны, это очень интересное теоретическое направление, и действительно здорово, что кто-то создал схему, позволяющую проводить постоянную по времени проверку, независимо от того, сколько выходов имеется в блокчейне, но на практике она не сработает и по-прежнему нуждается в серьёзных теоретических улучшениях.

Удалённая синхронизация кошельков - вроде как смежная идея. На самом она в большей степени связана с протоколом Jamtis, который, кажется, будет обсуждаться в воскресенье. Но я могу ошибаться. Одна из положительных особенностей Jamtis состоит в том, что он позволяет делегировать процесс синхронизации. И не так, как это делается в Monero сегодня, когда вы в любой момент можете передать свой ключ просмотра и попросить кого-то найти ваши выходы. В случае с Jamtis вы можете передать кому-то определённый ключ просмотра, и это кто-то сможет исключить 255 из 256 потенциальных выходов. Таким образом, значительно сокращается объём работы, которую приходится проделывать. Однако при этом нельзя увидеть, какие выходы принадлежат конкретно вам, что позволяет сохранить значительный уровень приватности.

Недостатком с точки зрения доверенной третьей стороны, способной сократить количество выходов, которые требуется просканировать, является то, что для каждого ключа, для которого производится сканирование, ей приходится просматривать все выходы. И этот линейно возрастающий объём работы по-прежнему является предметом обсуждения.

Если ввести полностью гомоморфное шифрование - почему бы нам не добавить чуть больше чисел, - то при той же теоретической сложности тот же процесс полного сканирования будет обходиться без какого-либо ущерба для приватности. Вместо того чтобы проделывать 250 пятых из 256 частей всей работы, можно просто заниматься остатком. Можно просканировать весь блокчейн, выдать точные выходы, принадлежащие вам, при этом доверенная сторона не будет знать, какие именно это были выходы. Это могло бы стать довольно мощным примитивом, не повышающим теоретической сложности. Для каждого ключа, для которого производилось бы сканирование, им всё равно приходилось бы применять алгоритм к каждому из выходов.

И ещё один момент: всё это можно реализовать вне протокола Monero. Уже сегодня можно создать кошелёк, поддерживающий этот механизм, и просто двигаться дальше.

Плохие новости: полностью гомоморфное шифрование само по себе очень медленно. По-настоящему медленно. Изначально в 2007 году речь шла о 30 секундах, необходимых для совершения двоичных операций. В процессе сканирования производится множество двоичных операций. Компьютеры выполняют их по умолчанию. И чтобы схема действительно стала жизнеспособной, сканирование выходов должно происходить быстрее, чем создание выхода в блокчейне Monero. Иначе происходит отставание, которое бесконечно увеличивается.

Сегодня существуют более эффективные протоколы, и я не уверен, достигли мы точки рентабельности или находимся в пределах пары порядков от неё. Если второе, то уже скоро всё это может стать горячей темой, особенно с ускорением USB, FPGA, соединение с которыми происходит через USB. Но это ничего не меняет. Это потребует много работы по разработке и внедрению. И тогда третья сторона сможет цензурировать транзакции, если только не будет создано доказательство с нулевым разглашением, также предполагающее наличие значительной вычислительной сложности.

И самая большая проблема, на мой взгляд, заключается в том, что после того, как мы перейдём на эти более эффективные протоколы, в будущем они, к сожалению, будут взломаны. И если это произойдёт, и выяснится, что они не являются приватными, то все, кто полагался на них, утратят свою приватность. Поэтому мы должны быть очень внимательны и не хвататься просто за самый последний и лучший протокол, но и учитывать все аспекты, связанные с безопасностью.

И, наконец, окончательный проблемный аспект с точки зрения Monero состоит в том, что мы, конечно же, можем добавить чисел и всё исправить, что делать с отправкой при использовании ненадёжного RPC. То есть, когда вы подключаетесь к удалённому узлу блокчейна, которому не доверяете. Это может быть буквально узел АНБ, пытающееся собрать больше информации о вас. Но вы всё равно отправляете через него свои транзакции и ожидаете, что ваша приватность при этом не пострадает.

Именно поэтому сегодня в Monero используются кольцевые подписи. А чтобы успешно создать кольцевую подпись, необходим ваш действительный выход и 15 ложных. Также необходимо иметь информацию о каждом выходе. И сегодня кошелёк Monero запрашивает информацию обо всех 16 выходах. Ему нужна информация только о 15 из них, потому что один из них - это его собственный выход, и у него уже есть эта информация. Но если будет запрошена информация только о 15 выходах, а через минуту в блокчейне появляется транзакция с этими 15 выходами и ещё одним, то сервер сразу же отметит наличие странного выхода. Ведь кто-то запросил информацию по всем остальным выходам, но не по этому. Он что, особенный? И сделает вывод, что именно этот выход расходуется. Доказательства участия на базе полного блокчейна заменяют кольца, но эта концепция пока что активно обсуждается.

Мы можем исправить это, и идея действительно окажется довольно жизнеспособной. Мы можем использовать механизм приватного извлечения информации, также известный как PIR и позволяющий запросить информацию о выходах или доказательства участия на базе полного блокчейна так, чтобы сервер не узнал информации, которая была запрошена. По сути, у сервера есть куча информации, вы можете запросить часть из неё, но сервер не сможет сказать, какую информацию вы только что получили в ответ. Даже несмотря на то, что сервер является тем, кто сообщает вам информацию. Он понятия не имеет, какую информацию он вам только что предоставил, и что вы запросили.

И это действительно позволяет достичь логарифмической сложности, что и требуется. Мы не можем иметь алгоритм, который при наличии 100 миллионов выходов перебирает все 100 миллионов, чтобы выдать ответ. При наличии логарифмической сложности он будет перебирать только несколько тысяч. В течение многих лет обсуждалось множество подобных схем, так что это большая область теоретических исследований. И несколько лет назад даже была создана замечательная демонстрация, четыре или пять лет назад, и она наглядно показывает, что теория развивается и постепенно совершенствуется. В Spiral Wiki вы можете просматривать английскую версию Википедии, и при этом сервер не будет знать, какую именно страницу вы просматриваете. Неважно, какую страницу вы запрашиваете, он не сможет определить, на какой странице вы находитесь, и это просто отличная демонстрация таких возможностей.

Так что, недостатком полностью гомоморфного шифрования является то, что оно медленное и заметно повышает требования к процессору, потому что теперь вместо того, чтобы после запроса информации о выходе сервер просто брал её из базы данных, вы передаёте зашифрованный фрагмент такого выхода, а сервер, чтобы получить ответ, запускает все эти криптографические механизмы, а затем выдаёт ответ вам в зашифрованном виде. Всё это происходит очень медленно. Но если вы зайдёте на сайт Spiral Wiki, то увидите, как их сервер, который используется только в демонстрационных целях, а не в промышленных масштабах, выдаёт полные страницы Википедии, только текст, в течение какой-то пары секунд. И я считаю, что это хорошая демонстрация потенциала данной технологии, тем более что это быстро развивающаяся область, пригодная для широкого применения для решения различных сложных проблем. Всё это связано с теми же рисками для приватности, когда мы полагаемся на PIR, а потом оказывается, что схема PIR на самом деле не предназначена для приватного поиска информации. Как результат, с точки зрения приватности мы оказываемся, мягко говоря, в неловкой ситуации. Поэтому следует быть осторожными. Но я считаю, что все эти схемы следует изучать и работать над ними в качестве долгосрочной цели, поскольку они, вероятно, позволят сэкономить пропускную способность и обеспечат более высокий уровень приватности в контексте доказательств участия на базе полного блокчейна.

Не уверен, осталось ли у нас есть время для вопросов, но это был своего рода "шведский стол" интересных проблем и странных криптографических решений, которыми мы можем воспользоваться. Если у нас есть время, я готов ответить на вопросы. Если нет, то я сделаю это позже.
