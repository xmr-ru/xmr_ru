---
title: "Sowle - Реализация протокола конфиденциальных активов в приватном блокчейне на базе алгоритмов доказательства работы и доказательства доли владения: опыт Zano"
date: "2024-06-07"
categories:
  - "Стенограмма"
tags:
  - "MoneroKon 2024"
lead: "Monero Konferenco 2024 #MoneroKon2024 Прага"
pager: true
toc: false
sidebar: "right"
---

{{< youtube id="hHaewqxxaNU" autoplay="false" >}}

---

_**Аннотация выступления**_

В презентации мы подробно рассказываем об интеграции конфиденциальных активов в блокчейн Zano. Эта инициатива позволяет осуществлять анонимные переводы и обмены активами (так называемые "ионические обмены") с использованием нескольких типов активов в рамках одной транзакции. Кроме того, мы обсудим, как конфиденциальные активы сочетаются с Zarcanum, схемой Proof-of-Stake, чтобы облегчить эгалитарный и анонимный стейкинг со скрытыми суммами.

_**Стенограмма выступления:**_

_**Sowle:**_ Всем привет! Я буду говорить о реализации протокола конфиденциальных активов в Zano. По сути, конфиденциальные активы - это просто токены, которые можно размещать, и которыми можно анонимно обмениваться. Этому и будет посвящена моя презентация. И я заранее прошу прощения за наличие некоторых технических подробностей.

И начнём с небольшого вступления: меня зовут Вэл. Также я известен как crypto sowle. Я являюсь ведущим исследователем проекта Zano и создателем сети Zarcanum. В прошлом году мы вместе с koe, разработчиком Monero, уже представили её на MoneroKon, а ранее - на Monerotopia.

Итак, в чём заключалась наша мотивация? Если вернуться на полтора года назад, то тогда в Zano мы использовали гибридный консенсус на базе протокола CryptoNote, блокчейна первого уровня, алгоритмов доказательства работы и доказательства доли владения. Мы реализовали концепцию приватного доказательства доли владения в тестовой сети Zarcanum и уже были готовы внедрить её на уровне основной сети. И тогда мы подумали, что, было бы неплохо в нашем блокчейне реализовать и поддержку протокола MultiAssets. Мы начали изучать эту область, поскольку, безусловно, хотели реализовать такую поддержку при условии сокрытия сумм и, возможно, сокрытия типа актива, чтобы внешний наблюдатель не мог догадаться, обмен какими активами происходит. Также мы хотели иметь единый анонимный пул для всех выходов в блокчейне, чтобы не возникало ситуации, в которой один выход принадлежал одному активу, а другой выход - какому-то другом, и при этом имелся бы ещё один набор выходов для стейкинга, например. Мы хотели, чтобы всё было унифицировано.

И мы обнаружили, что в этой области было проделано довольно много работы. Это была довольно непростая задача, и здесь я хотел бы упомянуть лишь некоторые работы. Прежде всего, это "Протокол конфиденциальных активов" Эндрю Поэлстра, Адама Бэка, Марка Фриденбаха, Грегори Максвелла и Питера Велле. Также в 2017 году была представлена концепция, которая, насколько я помню, позже была реализована в статье под названием "Liquid: сайдчейн Bitcoin" Джонаса Ника, Эндрю Поэлстра и Грегори Сандерса. Насколько мне известно, обе эти работы принадлежат исследователям из компании Blockstream. Затем была опубликована статья "Lelantus-CLA" Пирроса Хайдоса и Владислава Гельфера, в которой указанная концепция получила дальнейшее развитие. Также хотелось бы упомянуть статью "Spats: протокол конфиденциальных активов и невзаимозаменяемых токенов" Аарона и Арама, представленную на MoneroKon в прошлом году. А два дня назад все мы видели отличную презентацию по доказательствам Bulletproofs++ Лиама. Насколько мне известно, всё это тоже результат работы сотрудников Blockstream или людей, как-то связаных с Blockstream.

Итак, в данной области была проделана значительная работа, и, что довольно забавно, когда мы впервые задумались над реализацией протокола конфиденциальных активов в сети Zano, у нас возникло сразу две идеи. А позже, что тоже забавно, выяснилось, что обе эти идеи более или менее уже были представлены исследователями в разных работах. Поэтому мы придерживаемся одной из них. Наш подход во многом соответствует подходу Эндрю Поэлстра, изложенному в его работе "Протокол конфиденциальных активов".

Итак, прежде чем углубляться в детали реализации и соответствующих изменений, я хотел бы вкратце напомнить, как выглядят классический протокол CryptoNote и протокол кольцевых конфиденциальных транзакций RingCT. А затем я покажу, какие изменения были нами внесены для обеспечения соответствия протоколу конфиденциальных активов.

Итак, в классической версии протокола CryptoNote имеется некоторая сумма a, которая не скрыта. Она отображается в выходе, и её все видят. В случае с RingCT есть выход, который скрыт и подтверждается обязательством Педерсена, использующим коэффициент случайности f, и за этим всем стоит некоторая сумма. Основная идея в случае с протоколом конфиденциальных активов сводится к тому, что мы используем разные генераторы сумм для разных типов активов. Это очень простая концепция. Вместо того, чтобы указывать тип актива, то есть генератор актива, который мы используем для этого конкретного выхода, мы должны скрыть его, используя другое обязательство, используя другой коэффициент случайности, другую случайную погрешность. По сути, у нас есть генератор, в одной из работ названный тегом актива, а в другой - идентификатором актива, и у нас есть обязательство по активу, которое также называется слепым тегом актива. Поэтому внешний наблюдатель, глядя на этот выход, не сможет угадать, какой тип актива передаётся на самом деле.

Это очень простая идея. И теперь я хотел бы рассмотреть структуру транзакций CryptoNote и RingCT. В случае CryptoNote это очень простая структура: один вход и один выход. Для каждого выхода существует скрытый адрес и простая сумма. А в качестве входа берётся вход, ссылающийся на набор других выходов, известный как набор ложных выходов, и только один из них тратится на самом деле - некоторые для их обозначения используют индекс π, - и внешний наблюдатель не сможет сказать, не сможет угадать, какой из них на самом деле тратится. Но отправитель транзакции будет знать это наверняка. Ему будет известна секретная часть скрытого адреса. Поэтому для реализации этого подхода мы можем использовать классическую кольцевую подпись, с помощью доказательства с нулевым разглашением подтверждая, что нам действительно известна секретная часть одного из выходов, на которые ссылается подпись.

В реальном мире, конечно же, есть транзакции с несколькими входами и несколькими выходами, а доказательство базового баланса очень легко реализуется с помощью нативных методов путём сопоставления сумм со стороны входов и выходов и проверки отсутствия создания новых монет.

С появлением RingCT выходы более не содержали открытых сумм. Вместо этого они содержали обязательство по сумме, и такое обязательство помещалось в каждый выход. Здесь мы имеем ту же структуру, что и раньше: один вход ссылается на набор выходов, и только один из этого набора тратится по факту. Отправитель знает всю секретную часть скрытого адреса и обязательства по сумме. Он знает сумму a и использует коэффициент случайности f.

К сожалению, это обязательство по сумме может быть использовано в других доказательствах в данной транзакции, поскольку при использовании такого обязательства по сумме сразу станет ясно, какие выходы используются. И чтобы решить эту проблему, RingCT использует подход, называемый "псевдо-обязательством по выходу". Мы просто генерируем ещё одно обязательство по той же сумме a, что и в этом входе, но с другим коэффициентом случайности. И данное обязательство по сумме явно указывается в данных транзакции, и впоследствии используется в доказательствах. Для этого нам нужно всего лишь добавить ещё один уровень кольцевой подписи. Очень важно использовать не другую схему кольцевой подписи, а ещё один уровень существующей кольцевой подписи, поскольку нам нужно с помощью доказательства с нулевым разглашением подтвердить, что для того же индекса π, секретного индекса π, в одном из выходов имеются скрытый адрес и обязательство по сумме, которые соответствуют этому уравнению. Таким образом, отправителю известна секретная часть какого-то выхода, но никто не знает, какого именно.

И, конечно же, в реальной ситуации у нас мало выходов и входов, и благодаря гомоморфному свойству обязательств Педерсена мы можем суммировать обязательства вместо суммирования самой суммы. И, разумеется, при этом всём необходимо учитывать комиссию. По-моему, комиссия в случае RingCT явно указывается в дополнительном поле транзакции. Также необходимо учитывать старые выходы, доставшиеся от предыдущей эпохи, то есть, выходы, которые были сгенерированы много лет назад и всё ещё используют простые выходы.

Теперь я хотел бы рассказать о внесённых нами изменениях. Всё, что я сказал ранее, было связано с тем, что из себя представляет кольцевая подпись RingCT, и как она использовалась в Monero до сего момента. А теперь я хотел бы показать, какие изменения мы внесли, чтобы реализовать протокол конфиденциальных активов в рамках этой схемы.

В данном случае для каждого выхода мы вместе с обязательством по выходу должны включать обязательство по активу. Таким образом, структура практически та же самая. Единственное изменение, которое необходимо внести - нам нужно сгенерировать ещё одно обязательство по псевдо-выходу для актива, который используется. И вот у нас появляется третий уровень кольцевой подписи, поскольку нам с помощью доказательства с нулевым разглашением необходимо подтвердить, что отправитель транзакции действительно знает все эти секретные данные, а также то, что обязательство по псевдо-выходу сформировано надлежащим образом.

И здесь возникает проблема, поскольку мы не можем использовать классический подход CLSAC, так как у нас есть три уровня и два разных генератора. Мы могли бы использовать, MLSAC, например, но решили, что лучше попытаться модифицировать существующую схему CLSAC из-за её эффективности. И мы сделали именно это. Мы разработали схему под названием dv-CLSAC. Это просто расширение, которое позволяет использовать разные генераторы в CLSAC. Работа на эту тему была опубликована, и я очень благодарен Cypher Stack и Аарону за рецензирование.

Как и раньше, в реальной ситуации у нас есть несколько входов, несколько выходов, и мы по-прежнему, суммируя все обязательства со стороны входов и выходов, можем проверить баланс. И как и прежде, необходимо учитывать комиссию и старые выходы с открытыми суммами, которые создавались годы назад, и в Zano их много.

И здесь мы сталкиваемся с определённой проблемой, поскольку нам нужно каким-то образом убедиться, что эти обязательства по выходам в выходах сформированы надлежащим образом. Ведь, по сути, в RingCT у нас есть доказательства диапазона, которые гарантирующие правильность всех этих обязательств по выходам. А в случае с обязательствами по активам нам необходимо так называемое доказательство сюръекции активов, поскольку в противном случае злоумышленник смог бы использовать вредоносный генератор и смог бы сгенерировать монеты из воздуха. То есть, по сути, нам нужно доказать, конечно при условии нулевого разглашения, что в случае с каждым выходом генератор, используемый с активом, соответствует одному из входов. Это можно сделать, с помощью простой кольцевой подписи, как и предлагалось в оригинальной работе "Протокол конфиденциальных активов" Эндрю Поэлстра. Но мы решили попробовать другой, более эффективный с точки зрения экономии пространства подход, и в итоге фактически реализовали алгоритмическое доказательство участия по схеме "1-из-N", которое затем было представлено для обсуждения и улучшено в серии последующих работ.

И здесь я привожу три статьи, которыми мы воспользовались в нашей работе. К сожалению, я не нашёл ни одной статьи, которая объединяла бы в себе все эти улучшения. Это было бы очень удобно. Я даже подумываю над тем, чтобы написать такую статью. Исключительно из соображений удобства. Как бы то ни было, в итоге мы использовали логарифмическое доказательство, которое по занимаемому пространству составляет 4log,m плюс четыре элемента.

Кроме того, есть ещё одна проблема, связанная с использованием доказательств диапазона в такой схеме транзакций. Она делает невозможным использование агрегации доказательств диапазона, при этом Bulletproofs+ и Bulletproofs довольно хорошо обеспечивают такую агрегацию. То есть, вы можете использовать не одно доказательство диапазона для каждого выхода, а объединять их и предоставлять только одно доказательство для каждой транзакции. Это экономит много места. И именно с этим и возникает сложность, поскольку данный подход требует использования постоянного генератора для суммы и коэффициента случайности. А наш подход не допускает этого.

Чтобы решить эту проблему, мы решили добавить к каждому выходу дополнительное обязательство, используя другой фиксированный генератор U, который, конечно же, не имеет эффективно вычислимой алгоритмической связи со всеми остальными генераторами. И да, мы могли бы очень легко подтвердить с помощью доказательства с нулевым разглашением, что эти обязательства привязаны к одной и той же сумме. В результате мы можем использовать агрегацию с доказательством диапазона и экономить при этом много места.

Итак, мы рассмотрели структуру транзакций, позволяющую передавать конфиденциальный актив от одного пользователя другому. И мы убедились, что монеты не генерируются из воздуха. Но мы не рассмотрели, как при этом создаются активы. Это делается с помощью  структуры, открыто публикуемой в блокчейне. То есть, если я хочу выпустить актив, я регистрирую этот актив, добавляю специальную структуру данных, которую мы называем "дескриптором актива", и которая содержит тикер, количество монет, десятичная запятая и прочая необходимая информация. Также добавляется открытый ключ, который в будущем позволит управлять активом. Все эти данные хешируются, и в результате мы получаем случайную точку на эллиптической кривой, которая будет использоваться в качестве генератора суммы, так называемого тега актива.

И всякий раз, когда мне, как владельцу актива, будет нужно создать актив, публично сжечь его или изменить метаданные, мне будет необходимо предоставить доказательство права владения. Возвращаясь к рассмотренной нами схеме транзакций, всё, что нужно сделать, —добавить эту информацию в дополнительное поле транзакции вместе с обязательством по сумме создаваемого актива, и учесть его в уравнении доказательства подтверждения баланса. И это действительно работает.

И несколько слов о концепции Ionic Swaps. Пожалуй, идея данной концепции восходит к идее CoinJoin, предложенной Грегори Максвеллом в 2013 году. Суть её заключается в том, что один пользователь может создать частично подписанную транзакцию и передать её другому пользователю, который завершит транзакцию, после чего транзакция будет передана в блокчейн. И такой подход в сочетании с протоколом конфиденциальных активов позволяет пользователям мгновенно обмениваться активами друг с другом.

В данном примере Элис хочет обменять, скажем так, оранжевый актив на фиолетовый актив и создаёт частичную транзакцию, которая содержит только имеющийся у неё вход и выход, который она хотела бы получить. Эта транзакция отправляется Бобу, который хочет совершить сделку с Элис и обменяться этими активами. Боб завершает транзакцию, предоставляя входы для необходимых выходов и выходы для себя. Таким образом транзакция становится завершённой и может быть передана для включения добавления в блокчейн, а два человека при этом мгновенно, удобно и совершенно приватно обмениваются своими активами в блокчейне. И приватность в данном случае важна, поскольку внешний наблюдатель не сможет догадаться, каким именно типом актива обмениваются пользователи.

И ещё пара слов о Zarkanum. Когда мы реализовали всё, о чём я говорил до этого, мы столкнулись ещё с одной проблемой: нам не понравилось, что при стейкинге пользователи стали использовать свои активы вместо нативных монет. А нам хотелось, чтобы для этого использовались только нативные монеты. Схема транзакций Zarkanum была разработана задолго до того, как мы разработали решение для протокола конфиденциальных активов. И нам нужно было каким-то образом интегрировать их друг с другом. И вот как мы это сделали. Я не буду вдаваться в подробности принципов работы Zarkanum, но то, что тут показано, - это просто транзакция майнинга с доказательством доли владения. И Zarkanum требует добавления в каждый выход дополнительного обязательства и дополнительных обязательств по псевдо-выходам. Как итог мы просто добавили два уровня кольцевой подписи. И теперь для построения транзакций майнинга Zarkanum мы используем схему 5/2 CLSAC, поскольку у нас есть пять уровней, и при этом используются только два отдельных генератора.

И всё это действительно работает. Но так у нас есть ещё одна очень интересная проблема, связанная с анонимностью. Как я уже говорил, в транзакции мы скрываем тип актива, и внешний наблюдатель не может сказать, какие именно активы скрыты. Поэтому мы не знаем, это нативные монеты, USDT или Rapid в сети Bitcoin. Но конкретно в этой транзакции, показанной слева, со стороны входа у нас, очевидно, присутствуют только нативные монеты, поскольку только их можно использовать для стейкинга. А со стороны выхода у нас есть потенциально скрытые активы. И в этой ситуации очевидно, что все эти скрытые активы будут нативными монетами, поскольку если со стороны входа у вас только нативные монеты, то и со стороны выхода должны быть только нативные монеты, если только вы не выпускаете актив, а это не так. И это плохо с точки зрения анонимности, потому что, как уже было сказано, нам не нужен унифицированный пул выходов. Нам бы хотелось, чтобы в идеале все выходы содержали как можно меньше информации о типе актива.

И чтобы решить эту проблему, мы можем просто немного изменить эту транзакцию, предоставив другой вход. Итак, здесь у нас есть вход для стейкинга нативных монет, а здесь - просто произвольный вход из кошелька пользователя. Это может быть всё, что угодно. А кроме того, в транзакциях мы скрываем тип актива, чтобы потому внешний наблюдатель не мог угадать, какой из них является нативной монетой, а какой - нет. Это очень удобно.

Итак, чего же мы добились в итоге? Мы реализовали полную схему обмена конфиденциальными активами, которая работает в основной сети Zano с 21 марта. Мы назвали её хард-форком Zarkanum. Кроме того, данный хард-форк Zarkanum вводит доказательство доли владения Zarkanum, и теперь мы можем интегрировать протокол конфиденциальных активов, и каждый может создавать актив и использовать его. Кроме того, мы используем приватное доказательство доли владения. Таким образом, если вы делаете стейкинг монет в Zano, никакой внешний наблюдатель не сможет угадать, сколько у вас монет и так далее. И да, теперь каждый может создавать или сжигать свой актив и всячески управлять им. Кроме того, в кошельках Zano теперь реализован механизм Ionic Swaps, как в моём примере, где Элис и Боб могли участвовать в транзакции и обмениваться активами в блокчейне. И как я уже говорил, мы опубликовали статью о расширении схемы CLSAG, и она уже прошла рецензирование Cypher Stack.

На этом у меня всё. Спасибо за внимание.
