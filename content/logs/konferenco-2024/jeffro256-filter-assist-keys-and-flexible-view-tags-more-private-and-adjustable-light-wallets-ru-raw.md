---
title: "Jeffro256 - Фильтрующие ключи и гибкие теги просмотра: более приватные и настраиваемые лёгкие кошельки"
date: "2024-06-07"
categories:
  - "Стенограмма"
tags:
  - "MoneroKon 2024"
lead: "Monero Konferenco 2024 #MoneroKon2024 Прага"
pager: true
toc: false
sidebar: "right"
---

{{< youtube id="3XyMApKv4tE" autoplay="false" >}}

---

_**Аннотация выступления**_

Обновление протокола адресации Jamtis обеспечит создать уровень лёгких кошельков, гарантированно повышающий уровень приватности и масштабирования. До внесения соответствующих изменений серверы лёгких кошельков могли определить факт получения средств клиентом, если средства отправлялись на один и тот же адрес Jamtis дважды. Также они могли определить факт получения средств клиентом, если эти средства отправлялись на адрес Jamtis, известный серверу лёгкого кошелька. Наконец, сервер лёгкого кошелька мог с высокой вероятностью определить факт вспенивания и свободного обмена валюты клиентом. Последние изменения в Jamtis устраняют указанные проблемы, связанные с приватностью, и, как мы надеемся, открывают путь к реализации практически недетерминированных лёгких кошельков. В дополнение к повышению уровня приватности, добавление "гибких тегов просмотра" даёт сообществу возможность решить проблемы масштабирования лёгких кошельков путём обеспечения баланса между приватностью и требованиями к вычислениям без какой-либо необходимости в обновлении сети. В предлагаемом выступлении подробно рассматриваются плюсы и минусы этих изменений, то, что теоретически ещё только предстоит решить, а также то, как указанные изменения могут помочь в решении реальных задач.

_**Jeffro256:**_ Итак, почему именно Jamtis? Начнём с небольшого обзора.

Существующие адреса CryptoNote не имеют ключей просмотра исходящих транзакций, поэтому мы не можем просмотреть данные последовательно отправляемых транзакций. Подробнее мы поговорим об этом чуть позже. Некоторые из опережающих таблиц занимают слишком много памяти. Мы сталкиваемся с атаками Януса, существует слишком много типов адресов, но при этом нам нужен ещё один тип. А ещё для генерации адресов требуется наличие доступа к просмотру или идентификаторов платежей. Cakewallet, возможно, сталкивались со всеми этими сложностями. Если вы захотите сгенерировать новый адрес, за исключением случаев проведения произвольного количества платежей, вам потребуются ключи трат или доступ к просмотру идентификаторов платежей. Но самое главное для меня - проблема невероятно низкого уровня приватности лёгких кошельков. И я предлагаю поговорить об этом. Разобраться, почему всё так плохо.

Как показано на этой небольшой схеме, всякий раз, когда вы даёте свой ключ просмотра LWS, серверу лёгкого кошелька, он может просмотреть всю информацию о входящих e-note, включая сумму, даже в случаях с e-note сдачи. А в сочетании с информацией о кольце - и Джастин Берман очень хорошо рассказал об этом около года назад на предыдущей MoneroKon - предполагается, что ключи просмотра позволяют увидеть входящие данные только в 95 % случаев, но на самом деле транзакция видна во всех подробностях. И это очень плохо с точки зрения приватности. И в то же время не можете создать никаких приложений, работающих с исходящими суммами. Поэтому нам необходима новая схема, решающая все эти проблемы.

И небольшой дисклеймер: большая часть этой работы была проделана Ukoe и tevador. Я внёс лишь небольшие изменения. Так что надо отдать им должное - они проделали большую часть работы, связанной с Jamtis.

Итак, как Jamtis повышает приватность лёгких кошельков? Как и в случае CryptoNote, между отправителем и получателем создаётся общий секрет. Они помещают открытый ключ в блокчейн, и открытый ключ находится внутри адреса. То есть между сторонами существует общий секрет. В адресах CryptoNote отображается вся информация. Как я уже говорил, видно абсолютно всё: видны суммы, можно точно узнать, что на определённый адрес был получен e-note. Jamtis уже скрывает часть этой информации. Теперь вы видите тег просмотра и так называемый "тег адреса", о котором я расскажу позже. Вся остальная информация о транзакциях скрыта. Но упомянутый тег адреса станет для нас проблемой.

Мы можем использовать так называемый "ключ обнаружения входящих транзакций". Это старое название. Он передаётся серверу лёгкого кошелька и позволяет вычислить тег просмотра и тег адреса всех e-note. Но он не позволяет увидеть суммы и с уверенностью сказать, что вы владеете чем-либо. И именно этот ключ передаётся серверу лёгкого кошелька. Размер тега просмотра составляет примерно один байт. Это означает, что для него существует 256 различных значений для него. И это сокращает объём сканирования примерно на 99,6 %.

_**Комментарий из зала:**_ Примерно.

_**Jeffro256:**_ Да, примерно. Мы немного округляем. Скажем так, одно из 256. Вот, собственно, что я хочу сказать. Один байт может содержать 256 значений, и если говорить о совпадениях, вероятность совпадения с кем-то, не связанном с вами, составляет примерно один к 256. И это позволяет значительно сократить объём сканирования.

В чём же минусы такого подхода? Теги адресов представляют собой 128-битные фрагменты информации, закодированные в публичном адресе. Таким образом, какую-то часть времени получатели действительно владеют публичной информацией. Но эти теги генерируются случайным образом. А поскольку это 128 бит, вероятность того, что во время сканирования сервером лёгкого кошелька появятся два тега адреса, очень высока. И так как это будет сделано одним и тем же человек, с некоторой вероятностью можно будет определить, что именно он будет владельцем e-note. Сумма останется скрытой, но принадлежность двух тегов будет примерно известна. И точно так же, если вы уже знаете адрес и видите тег адреса во время сканирования, вы точно будете знать, что человек владеет конкретным e-note, что далеко от идеала.

Кроме того, вы не можете передать кому-либо секрет, позволяющий генерировать адреса от вашего имени, поскольку, теги адресов можно будет использовать, чтобы выявить все случаи получения вами средств. Даже несмотря на то, что суммы останутся скрытыми, третьей стороне точно будет известно, что вы стали получателем определённых транзакций.

Также существует проблема, связанная с тем, что при наличии чрезмерного количества тегов просмотра в одной транзакции, экспоненциально накапливается вероятность того, что все эти теги совпадут, хотя этого происходить не должно. То есть при наличии 16 совпадающих тегов просмотра, 8 бит, умноженных на 16, мы получаем 128 бит, чего не должно происходить ни по какой причине. Вероятность того, что это произойдёт случайно, если вы не имеете отношения к транзакции, примерно такая же, как если бы вы с первой попытки случайно угадали чей-то ключ AES. И если это произойдёт, можно будет сказать: "Да, этот парень имеет отношение к данной транзакции".

И наконец, вопрос, который может в связи со всем этим возникнуть: откуда взялось значение 256? Почему мы решили, что масштабирование составляет 99,6 %? Почему выбрано именно это значение? Хорошо ли оно? Всякий раз, когда у вас есть фиксированный размер, допустим, один байт, вы зацикливаетесь на нем. Будем ли это хорошо или нет в будущем, неизвестно. Возможно, мы захотим уменьшить значение. Возможно, захотим сократить размер анонимной группы в 50 раз. И нам будет важно сократить его именно в 50 раз. А что, если нам нужно будет отправлять 2000 транзакций в секунду, и в будущем мы захотим сократить их размер? Пока что это не представляется возможным.

Поэтому поговорим о том, как можно решить некоторые из этих проблем. Возвращаясь к исходному примеру, вот как будет работать новая версия. Как здесь показано, теперь у нас есть два общих секрета. Раньше был один, теперь два. Первый разблокирует только первичный тег просмотра, но теперь есть и вторичный тег просмотра. Второй ключ разблокирует всю остальную информацию о транзакциях в этом вторичном теге.

Поэтому первый ключ, фильтрующий ключ, передаётся серверу лёгкого кошелька, а второй ключ держится в секрете. При отсутствии второго ключа сервер лёгкого кошелька не сможет получить никакой другой информации о транзакциях.

В связи с этим размер адресов увеличивается. Внизу показан адрес криптовалютного узла, который выглядел бы так в случае со старой схемой Jamtis. Новая схема Jamtis делает его немного больше. Но она всё ещё помещается в твит. Я не буду называть сеть X.

И возникает хороший вопрос: теперь, когда происходит обмен двумя общими секретами, будет ли всё происходить вдвое медленнее? Хороший вопрос. Но нет. Во-первых, когда мы проверяем теги просмотра двух общих секретов, второй проверяется только один раз из 256. При этом размер тега просмотра составляет один байт. Так что в итоге процесс замедляется всего на 0,4 %. Уточню: это при полном сканировании кошелька. Так что если вы никогда не обращались к серверу лёгкого кошелька, эта функция сократит время сканирования всего на 0,4 %.

Пропустим эту часть и двинемся дальше. В старых тегах адресов есть небольшая вещь, называемая "подсказкой", и нам хотелось бы мы заменить её, добавив новый тег просмотра, позволяющий пропустить множество операций, обеспечивая тем самым определённую оптимизацию. Поскольку серверу лёгкого кошелька более не известны теги просмотра, он не может ничего проверить, и вместо операции шифрования мы должны совершить обмен ECDH, что на стороне клиента происходит примерно в 100 раз медленнее. Так как пропускная способность уже была примерно в 100 раз ниже, в случае со старым Jamtis всё было бы в 65 000 раз быстрее, а теперь примерно в 100 раз медленнее. И всё же это примерно в 100 раз быстрее, чем в случае с обычным кошельком. Однако этот компромисс следует учитывать.

Вы можете спросить: зачем нужны сразу два тега просмотра?

_**Комментарий из зала:**_ Для электронной почты?

_**Jeffro256:**_ Ну да, конечно. Мы хотим, чтобы для повышения производительности тег просмотра после второго обмена секретами заменял собой тег адреса. Но теперь мы можем смешать эти два тега. Мы можем использовать их сочетание. И это обеспечивает некоторую гибкость. Здесь мы уже можем говорить о гибкости. Есть некоторая неопределённость в том, как мы будем смешивать и сопоставлять эти два тега. При наличии большого количества npbits, первичный тег просмотра будет очень большим. А это значит, что нам придётся сильно сократить время сканирования. Нам нужно некоторое значение, которое станет кнопкой, запускающей это смешивание и добавляющей тем самым немного гибкости. Это как раз то, о чем я говорю. Высокое значение npbits. Значительный объём сжатия и сканирования. Это плохо с точки зрения анонимности, но теперь можно пойти на компромисс, что раньше было невозможно.

Теперь что касается проблем приватности тегов просмотра. Возвращаясь к этой проблеме, нужно отметить, что при наличии слишком большого количества совпадающих тегов, самое простое решение - сделать так, чтобы они не совпадали. И для лёгкого кошелька это означает, что ему придётся отправлять все e-note, имеющиеся в транзакции, если один из них совпадёт. Это также повысит пропускную способность. Но это изменение мы можем принять, а можем и не принять. Захотим ли мы этого, зависит от нас, но в результате приватность, обеспечиваемая свободным обменом и вспениванием, едва ли сохранится. Да, даже если в этой транзакции не совпадёт ни один из e-note, вы всё равно должны будете отправить их лёгкому кошельку.

И подведём некоторые итоги. Здесь было озвучено много информации, и вот хорошая лаконичная таблица функций, которые могут быть реализованы в рамках обновления Jamtis. Итак, существующие лёгкие кошельки не скрывают никакой информации e-note. Они не скрывают факта вспенивания и свободного обмена валют. Для этого у них нет никакого регулируемого механизма. Они также не позволяют генерировать адреса от имени пользователя без непременного и масштабного снижения уровня приватности.

И да, ещё я хотел бы немного поговорить об отсутствии у нас мгновенной синхронизации. Она, конечно же, будет примерно в 100 раз быстрее, чем в случае с полными кошельками. Но она не будет мгновенной, потому что при этом придётся отправлять около 0,4 % данных, сохраняемых в блокчейне.

И несколько вариантов реализации. Вы можете позволить кому-то генерировать адреса от вашего имени. Вы можете сделать это с помощью Venmo, например. Этот сервис может генерировать адреса для вас от вашего имени. И если я захочу связаться, например, с Люком и перевести ему деньги, мне не придётся с ним взаимодействовать. Мне не нужно будет переписываться с ним в твиттере. Сервис легко и просто сгенерирует для меня адрес. Он сделает это для любого человека, абсолютно не взаимодействуя с ним. И это может быть доказано, проверено не интерактивно.

Что касается LWS, гораздо проще предложить кому-то пользоваться LWS, если при этом вы не будете видеть всех данных транзакций. То есть, вы не будете видеть данных транзакций, но при этом сможете предложить быструю синхронизацию. И мои друзья частенько достают меня по этому поводу.

Но для тех, для кого проблема приватности беспокоит на уровне паранойи - это сделает работу холодных-горячих кошельков ещё более приватной, чем сейчас. Обычно это работает так: у вас есть ключ просмотра, вы сканируете его на стороне горячего кошелька, переносите эту информацию на сторону холодного, а затем переносите данные образа ключа обратно на сторону горячего кошелька. Теперь вы можете полностью сохранить всё со стороны холодного кошелька, с которого совершается трата, произвести сканирование, выполнить вторую часть сканирования на устройстве, которое, скажем так, является полухолодным. И если вам по душе решения, предлагаемые AirGap, это вам поможет.

Что касается самостоятельно поддерживаемых LWS - некоторые действительно предпочитают иметь собственный сервер лёгких кошельков. Так, например, существует OpenMonero, версия MyMonero с открытым исходным кодом. Вы можете запустить сервер самостоятельно. Но если его взломают, вы рискуете раскрыть свой баланс и полную историю транзакций, за некоторыми исключениями. Сейчас этого не случится. Вы раскроете только 4 % данных блокчейна, и злоумышленник не сможет извлечь из этого какую-либо точную информацию. Кроме того, теперь ещё добавилась поддержка приватного свободного обмена и лёгких кошельков, что раньше было невозможно.

Что ещё остаётся? Несколько видов атак. Всё это, за исключением скорости, не совсем бесплатно. Также мы не можем говорить о полной приватности. Прошу прощения. Это я упустил, но ладно.

Итак, лёгкие кошельки, их серверы по-прежнему могут вероятностно соотнести пользователей на основе количества совпадений тегов просмотров и совместных транзакций. Таким образом, если есть сеть, и на сервере, в одном месте, хранится куча чужих ключей, и я отправляю множество транзакций своему другу снова и снова, сервер может увидеть статистически маловероятное количество транзакций с одинаковыми тегами просмотра. И эта информация может использоваться для построения вероятностного социального графа источника. И это один из видов атаки. Второй вид - допустим, мы имеем дело с упомянутым ранее примером. Допустим, вы покупали у кого-то непастеризованное молоко. Допустим, вы делали это 20 раз. А потом продавца арестовали за то, что оно непастеризованное. Значит, кто-то получает доступ к набору транзакций и набор первичных тегов просмотра, которые статистически чаще совпадают с набором транзакций. И чем чаще вы взаимодействовали с продавцом, тем выше будет вероятность. Пока что нельзя будет сказать чего-то определённого, но если  сервер продавца или ваш сервер лёгкого кошелька будет взломан, с более высокой вероятностью можно будет сказать, что вы были участником этих транзакций.

И вот на этом у меня всё.
